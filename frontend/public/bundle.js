!function(){"use strict";class t{device;objects;constructor(t){this.device=t,this.objects=[],console.log("Scene created.")}addObject(t){this.objects.push(t)}removeObject(t){const n=this.objects.indexOf(t);n>-1&&this.objects.splice(n,1)}getObjects(){return this.objects}draw(t,n){for(const e of this.objects)e.draw(t,n)}}class n{device;pipeline;vertexBuffer;color;position;uniformBuffer;bindGroup;constructor(t,n,e){this.device=t,this.color=new Float32Array(n),this.position=new Float32Array(e),this.initializeBuffers(),this.createPipeline()}initializeBuffers(){this.createVertexBuffer(),this.createUniformBuffer()}createVertexBuffer(){const t=new Float32Array([0+this.position[0],.5+this.position[1],this.position[2],1,-.5+this.position[0],-.5+this.position[1],this.position[2],1,.5+this.position[0],-.5+this.position[1],this.position[2],1]);this.vertexBuffer=this.device.createBuffer({size:t.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.vertexBuffer.getMappedRange()).set(t),this.vertexBuffer.unmap()}createUniformBuffer(){this.uniformBuffer=this.device.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}createPipeline(){const t=`\n        @fragment\n        fn fs_main() -> @location(0) vec4<f32> {\n            return vec4<f32>(${this.color.join(",")});\n        }`;this.pipeline=this.device.createRenderPipeline({label:"triangle-pipeline",layout:"auto",vertex:{module:this.device.createShaderModule({code:"\n        struct Uniforms {\n    viewMatrix: mat4x4<f32>,\n    projectionMatrix: mat4x4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: Uniforms;\n\n@vertex\nfn vs_main(@location(0) position: vec4<f32>) -> @builtin(position) vec4<f32> {\n    let worldPosition = position;\n    let viewPosition = uniforms.viewMatrix * worldPosition;\n    let clipPosition = uniforms.projectionMatrix * viewPosition;\n    return clipPosition;\n}"}),entryPoint:"vs_main",buffers:[{arrayStride:16,attributes:[{shaderLocation:0,offset:0,format:"float32x4"}]}]},fragment:{module:this.device.createShaderModule({code:t}),entryPoint:"fs_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list"}}),this.createBindGroup()}createBindGroup(){const t=this.pipeline.getBindGroupLayout(0);this.bindGroup=this.device.createBindGroup({layout:t,entries:[{binding:0,resource:{buffer:this.uniformBuffer,size:128}}]})}draw(t,n){this.device.queue.writeBuffer(this.uniformBuffer,0,n.viewMatrix.buffer,n.viewMatrix.byteOffset,n.viewMatrix.byteLength),this.device.queue.writeBuffer(this.uniformBuffer,64,n.projectionMatrix.buffer,n.projectionMatrix.byteOffset,n.projectionMatrix.byteLength),t.setPipeline(this.pipeline),t.setVertexBuffer(0,this.vertexBuffer),t.setBindGroup(0,this.bindGroup),t.draw(3,1,0,0)}}class e{device;pipeline;vertexBuffer;indexBuffer;color;position;radius=.5;numIndices;uniformBuffer;bindGroup;constructor(t,n,e,r){this.device=t,this.color=new Float32Array(n),this.position=new Float32Array(e),this.radius=r,this.initializeBuffers(),this.createPipeline()}initializeBuffers(){this.createVertexBuffer(),this.createUniformBuffer()}createVertexBuffer(){const t=32,n=[],e=[];for(let e=0;e<=t;e++){const r=e*Math.PI/t,o=Math.sin(r),i=Math.cos(r);for(let e=0;e<=t;e++){const r=2*e*Math.PI/t,s=Math.sin(r),a=Math.cos(r),c=this.radius*a*o,u=this.radius*i,h=this.radius*s*o;n.push(c+this.position[0],u+this.position[1],h+this.position[2],1)}}for(let n=0;n<t;n++)for(let r=0;r<t;r++){const o=33*n+r,i=o+t+1;e.push(o,i,o+1),e.push(i,i+1,o+1)}this.numIndices=e.length,this.vertexBuffer=this.device.createBuffer({size:4*n.length,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.vertexBuffer.getMappedRange()).set(new Float32Array(n)),this.vertexBuffer.unmap(),this.indexBuffer=this.device.createBuffer({size:4*e.length,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0}),new Uint32Array(this.indexBuffer.getMappedRange()).set(new Uint32Array(e)),this.indexBuffer.unmap()}createUniformBuffer(){this.uniformBuffer=this.device.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}createPipeline(){const t=`\n            @fragment\n            fn fs_main() -> @location(0) vec4<f32> {\n                return vec4<f32>(${this.color.join(",")});\n            }\n        `;this.pipeline=this.device.createRenderPipeline({layout:"auto",label:"sphere-pipeline",vertex:{module:this.device.createShaderModule({code:"\n            struct Uniforms {\n            viewMatrix: mat4x4<f32>,\n            projectionMatrix: mat4x4<f32>,\n            };\n\n            @group(0) @binding(0) var<uniform> uniforms: Uniforms;\n\n            @vertex\n            fn vs_main(@location(0) position: vec4<f32>) -> @builtin(position) vec4<f32> {\n                let worldPosition = vec4<f32>(position.xyz, 1.0); // Ensure position is a 4-component vector\n                let viewPosition = uniforms.viewMatrix * worldPosition;\n                let clipPosition = uniforms.projectionMatrix * viewPosition;\n                return clipPosition;\n            }"}),entryPoint:"vs_main",buffers:[{arrayStride:16,attributes:[{shaderLocation:0,offset:0,format:"float32x4"}]}]},fragment:{module:this.device.createShaderModule({code:t}),entryPoint:"fs_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list"}}),this.createBindGroup()}createBindGroup(){const t=this.pipeline.getBindGroupLayout(0);this.bindGroup=this.device.createBindGroup({layout:t,entries:[{binding:0,resource:{buffer:this.uniformBuffer,size:128}}]})}draw(t,n){this.device.queue.writeBuffer(this.uniformBuffer,0,n.viewMatrix.buffer,n.viewMatrix.byteOffset,n.viewMatrix.byteLength),this.device.queue.writeBuffer(this.uniformBuffer,64,n.projectionMatrix.buffer,n.projectionMatrix.byteOffset,n.projectionMatrix.byteLength),t.setPipeline(this.pipeline),t.setVertexBuffer(0,this.vertexBuffer),t.setIndexBuffer(this.indexBuffer,"uint32"),t.setBindGroup(0,this.bindGroup),t.drawIndexed(this.numIndices)}}const r=(o=Array,i=t=>t.fill(0),class extends o{constructor(...t){super(...t),i(this)}});var o,i;let s=1e-6;const a=new Map;function c(t){let n=a.get(t);return n||(n=function(t){function n(n=0,e=0){const r=new t(2);return void 0!==n&&(r[0]=n,void 0!==e&&(r[1]=e)),r}function e(n,e,r){const o=r??new t(2);return o[0]=n[0]-e[0],o[1]=n[1]-e[1],o}function r(n,e,r,o){const i=o??new t(2);return i[0]=n[0]+r*(e[0]-n[0]),i[1]=n[1]+r*(e[1]-n[1]),i}function o(n,e,r){const o=r??new t(2);return o[0]=n[0]*e,o[1]=n[1]*e,o}function i(n,e){const r=e??new t(2);return r[0]=1/n[0],r[1]=1/n[1],r}function a(t,n){return t[0]*n[0]+t[1]*n[1]}function c(t){const n=t[0],e=t[1];return Math.sqrt(n*n+e*e)}function u(t){const n=t[0],e=t[1];return n*n+e*e}function h(t,n){const e=t[0]-n[0],r=t[1]-n[1];return Math.sqrt(e*e+r*r)}function f(t,n){const e=t[0]-n[0],r=t[1]-n[1];return e*e+r*r}function l(n,e){const r=e??new t(2),o=n[0],i=n[1],s=Math.sqrt(o*o+i*i);return s>1e-5?(r[0]=o/s,r[1]=i/s):(r[0]=0,r[1]=0),r}function d(n,e){const r=e??new t(2);return r[0]=n[0],r[1]=n[1],r}function M(n,e,r){const o=r??new t(2);return o[0]=n[0]*e[0],o[1]=n[1]*e[1],o}function w(n,e,r){const o=r??new t(2);return o[0]=n[0]/e[0],o[1]=n[1]/e[1],o}function m(n,e,r){const i=r??new t(2);return l(n,i),o(i,e,i)}return{create:n,fromValues:n,set:function(n,e,r){const o=r??new t(2);return o[0]=n,o[1]=e,o},ceil:function(n,e){const r=e??new t(2);return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r},floor:function(n,e){const r=e??new t(2);return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r},round:function(n,e){const r=e??new t(2);return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r},clamp:function(n,e=0,r=1,o){const i=o??new t(2);return i[0]=Math.min(r,Math.max(e,n[0])),i[1]=Math.min(r,Math.max(e,n[1])),i},add:function(n,e,r){const o=r??new t(2);return o[0]=n[0]+e[0],o[1]=n[1]+e[1],o},addScaled:function(n,e,r,o){const i=o??new t(2);return i[0]=n[0]+e[0]*r,i[1]=n[1]+e[1]*r,i},angle:function(t,n){const e=t[0],r=t[1],o=n[0],i=n[1],s=Math.sqrt(e*e+r*r)*Math.sqrt(o*o+i*i),c=s&&a(t,n)/s;return Math.acos(c)},subtract:e,sub:e,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]},lerp:r,lerpV:function(n,e,r,o){const i=o??new t(2);return i[0]=n[0]+r[0]*(e[0]-n[0]),i[1]=n[1]+r[1]*(e[1]-n[1]),i},max:function(n,e,r){const o=r??new t(2);return o[0]=Math.max(n[0],e[0]),o[1]=Math.max(n[1],e[1]),o},min:function(n,e,r){const o=r??new t(2);return o[0]=Math.min(n[0],e[0]),o[1]=Math.min(n[1],e[1]),o},mulScalar:o,scale:o,divScalar:function(n,e,r){const o=r??new t(2);return o[0]=n[0]/e,o[1]=n[1]/e,o},inverse:i,invert:i,cross:function(n,e,r){const o=r??new t(3),i=n[0]*e[1]-n[1]*e[0];return o[0]=0,o[1]=0,o[2]=i,o},dot:a,length:c,len:c,lengthSq:u,lenSq:u,distance:h,dist:h,distanceSq:f,distSq:f,normalize:l,negate:function(n,e){const r=e??new t(2);return r[0]=-n[0],r[1]=-n[1],r},copy:d,clone:d,multiply:M,mul:M,divide:w,div:w,random:function(n=1,e){const r=e??new t(2),o=2*Math.random()*Math.PI;return r[0]=Math.cos(o)*n,r[1]=Math.sin(o)*n,r},zero:function(n){const e=n??new t(2);return e[0]=0,e[1]=0,e},transformMat4:function(n,e,r){const o=r??new t(2),i=n[0],s=n[1];return o[0]=i*e[0]+s*e[4]+e[12],o[1]=i*e[1]+s*e[5]+e[13],o},transformMat3:function(n,e,r){const o=r??new t(2),i=n[0],s=n[1];return o[0]=e[0]*i+e[4]*s+e[8],o[1]=e[1]*i+e[5]*s+e[9],o},rotate:function(n,e,r,o){const i=o??new t(2),s=n[0]-e[0],a=n[1]-e[1],c=Math.sin(r),u=Math.cos(r);return i[0]=s*u-a*c+e[0],i[1]=s*c+a*u+e[1],i},setLength:m,truncate:function(n,e,r){const o=r??new t(2);return c(n)>e?m(n,e,o):d(n,o)},midpoint:function(n,e,o){return r(n,e,.5,o??new t(2))}}}(t),a.set(t,n)),n}const u=new Map;function h(t){let n=u.get(t);return n||(n=function(t){function n(n,e,r){const o=new t(3);return void 0!==n&&(o[0]=n,void 0!==e&&(o[1]=e,void 0!==r&&(o[2]=r))),o}function e(n,e,r){const o=r??new t(3);return o[0]=n[0]-e[0],o[1]=n[1]-e[1],o[2]=n[2]-e[2],o}function r(n,e,r,o){const i=o??new t(3);return i[0]=n[0]+r*(e[0]-n[0]),i[1]=n[1]+r*(e[1]-n[1]),i[2]=n[2]+r*(e[2]-n[2]),i}function o(n,e,r){const o=r??new t(3);return o[0]=n[0]*e,o[1]=n[1]*e,o[2]=n[2]*e,o}function i(n,e){const r=e??new t(3);return r[0]=1/n[0],r[1]=1/n[1],r[2]=1/n[2],r}function a(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function c(t){const n=t[0],e=t[1],r=t[2];return Math.sqrt(n*n+e*e+r*r)}function u(t){const n=t[0],e=t[1],r=t[2];return n*n+e*e+r*r}function h(t,n){const e=t[0]-n[0],r=t[1]-n[1],o=t[2]-n[2];return Math.sqrt(e*e+r*r+o*o)}function f(t,n){const e=t[0]-n[0],r=t[1]-n[1],o=t[2]-n[2];return e*e+r*r+o*o}function l(n,e){const r=e??new t(3),o=n[0],i=n[1],s=n[2],a=Math.sqrt(o*o+i*i+s*s);return a>1e-5?(r[0]=o/a,r[1]=i/a,r[2]=s/a):(r[0]=0,r[1]=0,r[2]=0),r}function d(n,e){const r=e??new t(3);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r}function M(n,e,r){const o=r??new t(3);return o[0]=n[0]*e[0],o[1]=n[1]*e[1],o[2]=n[2]*e[2],o}function w(n,e,r){const o=r??new t(3);return o[0]=n[0]/e[0],o[1]=n[1]/e[1],o[2]=n[2]/e[2],o}function m(n,e,r){const i=r??new t(3);return l(n,i),o(i,e,i)}return{create:n,fromValues:n,set:function(n,e,r,o){const i=o??new t(3);return i[0]=n,i[1]=e,i[2]=r,i},ceil:function(n,e){const r=e??new t(3);return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r[2]=Math.ceil(n[2]),r},floor:function(n,e){const r=e??new t(3);return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r[2]=Math.floor(n[2]),r},round:function(n,e){const r=e??new t(3);return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r[2]=Math.round(n[2]),r},clamp:function(n,e=0,r=1,o){const i=o??new t(3);return i[0]=Math.min(r,Math.max(e,n[0])),i[1]=Math.min(r,Math.max(e,n[1])),i[2]=Math.min(r,Math.max(e,n[2])),i},add:function(n,e,r){const o=r??new t(3);return o[0]=n[0]+e[0],o[1]=n[1]+e[1],o[2]=n[2]+e[2],o},addScaled:function(n,e,r,o){const i=o??new t(3);return i[0]=n[0]+e[0]*r,i[1]=n[1]+e[1]*r,i[2]=n[2]+e[2]*r,i},angle:function(t,n){const e=t[0],r=t[1],o=t[2],i=n[0],s=n[1],c=n[2],u=Math.sqrt(e*e+r*r+o*o)*Math.sqrt(i*i+s*s+c*c),h=u&&a(t,n)/u;return Math.acos(h)},subtract:e,sub:e,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s&&Math.abs(t[2]-n[2])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]},lerp:r,lerpV:function(n,e,r,o){const i=o??new t(3);return i[0]=n[0]+r[0]*(e[0]-n[0]),i[1]=n[1]+r[1]*(e[1]-n[1]),i[2]=n[2]+r[2]*(e[2]-n[2]),i},max:function(n,e,r){const o=r??new t(3);return o[0]=Math.max(n[0],e[0]),o[1]=Math.max(n[1],e[1]),o[2]=Math.max(n[2],e[2]),o},min:function(n,e,r){const o=r??new t(3);return o[0]=Math.min(n[0],e[0]),o[1]=Math.min(n[1],e[1]),o[2]=Math.min(n[2],e[2]),o},mulScalar:o,scale:o,divScalar:function(n,e,r){const o=r??new t(3);return o[0]=n[0]/e,o[1]=n[1]/e,o[2]=n[2]/e,o},inverse:i,invert:i,cross:function(n,e,r){const o=r??new t(3),i=n[2]*e[0]-n[0]*e[2],s=n[0]*e[1]-n[1]*e[0];return o[0]=n[1]*e[2]-n[2]*e[1],o[1]=i,o[2]=s,o},dot:a,length:c,len:c,lengthSq:u,lenSq:u,distance:h,dist:h,distanceSq:f,distSq:f,normalize:l,negate:function(n,e){const r=e??new t(3);return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r},copy:d,clone:d,multiply:M,mul:M,divide:w,div:w,random:function(n=1,e){const r=e??new t(3),o=2*Math.random()*Math.PI,i=2*Math.random()-1,s=Math.sqrt(1-i*i)*n;return r[0]=Math.cos(o)*s,r[1]=Math.sin(o)*s,r[2]=i*n,r},zero:function(n){const e=n??new t(3);return e[0]=0,e[1]=0,e[2]=0,e},transformMat4:function(n,e,r){const o=r??new t(3),i=n[0],s=n[1],a=n[2],c=e[3]*i+e[7]*s+e[11]*a+e[15]||1;return o[0]=(e[0]*i+e[4]*s+e[8]*a+e[12])/c,o[1]=(e[1]*i+e[5]*s+e[9]*a+e[13])/c,o[2]=(e[2]*i+e[6]*s+e[10]*a+e[14])/c,o},transformMat4Upper3x3:function(n,e,r){const o=r??new t(3),i=n[0],s=n[1],a=n[2];return o[0]=i*e[0]+s*e[4]+a*e[8],o[1]=i*e[1]+s*e[5]+a*e[9],o[2]=i*e[2]+s*e[6]+a*e[10],o},transformMat3:function(n,e,r){const o=r??new t(3),i=n[0],s=n[1],a=n[2];return o[0]=i*e[0]+s*e[4]+a*e[8],o[1]=i*e[1]+s*e[5]+a*e[9],o[2]=i*e[2]+s*e[6]+a*e[10],o},transformQuat:function(n,e,r){const o=r??new t(3),i=e[0],s=e[1],a=e[2],c=2*e[3],u=n[0],h=n[1],f=n[2],l=s*f-a*h,d=a*u-i*f,M=i*h-s*u;return o[0]=u+l*c+2*(s*M-a*d),o[1]=h+d*c+2*(a*l-i*M),o[2]=f+M*c+2*(i*d-s*l),o},getTranslation:function(n,e){const r=e??new t(3);return r[0]=n[12],r[1]=n[13],r[2]=n[14],r},getAxis:function(n,e,r){const o=r??new t(3),i=4*e;return o[0]=n[i+0],o[1]=n[i+1],o[2]=n[i+2],o},getScaling:function(n,e){const r=e??new t(3),o=n[0],i=n[1],s=n[2],a=n[4],c=n[5],u=n[6],h=n[8],f=n[9],l=n[10];return r[0]=Math.sqrt(o*o+i*i+s*s),r[1]=Math.sqrt(a*a+c*c+u*u),r[2]=Math.sqrt(h*h+f*f+l*l),r},rotateX:function(n,e,r,o){const i=o??new t(3),s=[],a=[];return s[0]=n[0]-e[0],s[1]=n[1]-e[1],s[2]=n[2]-e[2],a[0]=s[0],a[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),a[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),i[0]=a[0]+e[0],i[1]=a[1]+e[1],i[2]=a[2]+e[2],i},rotateY:function(n,e,r,o){const i=o??new t(3),s=[],a=[];return s[0]=n[0]-e[0],s[1]=n[1]-e[1],s[2]=n[2]-e[2],a[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),a[1]=s[1],a[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),i[0]=a[0]+e[0],i[1]=a[1]+e[1],i[2]=a[2]+e[2],i},rotateZ:function(n,e,r,o){const i=o??new t(3),s=[],a=[];return s[0]=n[0]-e[0],s[1]=n[1]-e[1],s[2]=n[2]-e[2],a[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),a[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),a[2]=s[2],i[0]=a[0]+e[0],i[1]=a[1]+e[1],i[2]=a[2]+e[2],i},setLength:m,truncate:function(n,e,r){const o=r??new t(3);return c(n)>e?m(n,e,o):d(n,o)},midpoint:function(n,e,o){return r(n,e,.5,o??new t(3))}}}(t),u.set(t,n)),n}const f=new Map;function l(t){let n=f.get(t);return n||(n=function(t){const n=c(t),e=h(t);function r(n,e){const r=e??new t(12);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[8]=n[8],r[9]=n[9],r[10]=n[10],r}function o(n){const e=n??new t(12);return e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=1,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function i(n,e){const r=e??new t(12),o=n[0],i=n[1],s=n[2],a=n[4],c=n[5],u=n[6],h=n[8],f=n[9],l=n[10],d=l*c-u*f,M=-l*a+u*h,w=f*a-c*h,m=1/(o*d+i*M+s*w);return r[0]=d*m,r[1]=(-l*i+s*f)*m,r[2]=(u*i-s*c)*m,r[4]=M*m,r[5]=(l*o-s*h)*m,r[6]=(-u*o+s*a)*m,r[8]=w*m,r[9]=(-f*o+i*h)*m,r[10]=(c*o-i*a)*m,r}function a(n,e,r){const o=r??new t(12),i=n[0],s=n[1],a=n[2],c=n[4],u=n[5],h=n[6],f=n[8],l=n[9],d=n[10],M=e[0],w=e[1],m=e[2],p=e[4],v=e[5],g=e[6],b=e[8],x=e[9],y=e[10];return o[0]=i*M+c*w+f*m,o[1]=s*M+u*w+l*m,o[2]=a*M+h*w+d*m,o[4]=i*p+c*v+f*g,o[5]=s*p+u*v+l*g,o[6]=a*p+h*v+d*g,o[8]=i*b+c*x+f*y,o[9]=s*b+u*x+l*y,o[10]=a*b+h*x+d*y,o}return{clone:r,create:function(n,e,r,o,i,s,a,c,u){const h=new t(12);return h[3]=0,h[7]=0,h[11]=0,void 0!==n&&(h[0]=n,void 0!==e&&(h[1]=e,void 0!==r&&(h[2]=r,void 0!==o&&(h[4]=o,void 0!==i&&(h[5]=i,void 0!==s&&(h[6]=s,void 0!==a&&(h[8]=a,void 0!==c&&(h[9]=c,void 0!==u&&(h[10]=u))))))))),h},set:function(n,e,r,o,i,s,a,c,u,h){const f=h??new t(12);return f[0]=n,f[1]=e,f[2]=r,f[3]=0,f[4]=o,f[5]=i,f[6]=s,f[7]=0,f[8]=a,f[9]=c,f[10]=u,f[11]=0,f},fromMat4:function(n,e){const r=e??new t(12);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=0,r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=0,r},fromQuat:function(n,e){const r=e??new t(12),o=n[0],i=n[1],s=n[2],a=n[3],c=o+o,u=i+i,h=s+s,f=o*c,l=i*c,d=i*u,M=s*c,w=s*u,m=s*h,p=a*c,v=a*u,g=a*h;return r[0]=1-d-m,r[1]=l+g,r[2]=M-v,r[3]=0,r[4]=l-g,r[5]=1-f-m,r[6]=w+p,r[7]=0,r[8]=M+v,r[9]=w-p,r[10]=1-f-d,r[11]=0,r},negate:function(n,e){const r=e??new t(12);return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[4]=-n[4],r[5]=-n[5],r[6]=-n[6],r[8]=-n[8],r[9]=-n[9],r[10]=-n[10],r},copy:r,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s&&Math.abs(t[2]-n[2])<s&&Math.abs(t[4]-n[4])<s&&Math.abs(t[5]-n[5])<s&&Math.abs(t[6]-n[6])<s&&Math.abs(t[8]-n[8])<s&&Math.abs(t[9]-n[9])<s&&Math.abs(t[10]-n[10])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]},identity:o,transpose:function(n,e){const r=e??new t(12);if(r===n){let t;return t=n[1],n[1]=n[4],n[4]=t,t=n[2],n[2]=n[8],n[8]=t,t=n[6],n[6]=n[9],n[9]=t,r}const o=n[0],i=n[1],s=n[2],a=n[4],c=n[5],u=n[6],h=n[8],f=n[9],l=n[10];return r[0]=o,r[1]=a,r[2]=h,r[4]=i,r[5]=c,r[6]=f,r[8]=s,r[9]=u,r[10]=l,r},inverse:i,invert:i,determinant:function(t){const n=t[0],e=t[1],r=t[2],o=t[4],i=t[5],s=t[6],a=t[8],c=t[9],u=t[10];return n*(i*u-c*s)-o*(e*u-c*r)+a*(e*s-i*r)},mul:a,multiply:a,setTranslation:function(t,n,e){const r=e??o();return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[4]=t[4],r[5]=t[5],r[6]=t[6]),r[8]=n[0],r[9]=n[1],r[10]=1,r},getTranslation:function(t,e){const r=e??n.create();return r[0]=t[8],r[1]=t[9],r},getAxis:function(t,e,r){const o=r??n.create(),i=4*e;return o[0]=t[i+0],o[1]=t[i+1],o},setAxis:function(t,n,e,o){const i=o===t?t:r(t,o),s=4*e;return i[s+0]=n[0],i[s+1]=n[1],i},getScaling:function(t,e){const r=e??n.create(),o=t[0],i=t[1],s=t[4],a=t[5];return r[0]=Math.sqrt(o*o+i*i),r[1]=Math.sqrt(s*s+a*a),r},get3DScaling:function(t,n){const r=n??e.create(),o=t[0],i=t[1],s=t[2],a=t[4],c=t[5],u=t[6],h=t[8],f=t[9],l=t[10];return r[0]=Math.sqrt(o*o+i*i+s*s),r[1]=Math.sqrt(a*a+c*c+u*u),r[2]=Math.sqrt(h*h+f*f+l*l),r},translation:function(n,e){const r=e??new t(12);return r[0]=1,r[1]=0,r[2]=0,r[4]=0,r[5]=1,r[6]=0,r[8]=n[0],r[9]=n[1],r[10]=1,r},translate:function(n,e,r){const o=r??new t(12),i=e[0],s=e[1],a=n[0],c=n[1],u=n[2],h=n[4],f=n[5],l=n[6],d=n[8],M=n[9],w=n[10];return n!==o&&(o[0]=a,o[1]=c,o[2]=u,o[4]=h,o[5]=f,o[6]=l),o[8]=a*i+h*s+d,o[9]=c*i+f*s+M,o[10]=u*i+l*s+w,o},rotation:function(n,e){const r=e??new t(12),o=Math.cos(n),i=Math.sin(n);return r[0]=o,r[1]=i,r[2]=0,r[4]=-i,r[5]=o,r[6]=0,r[8]=0,r[9]=0,r[10]=1,r},rotate:function(n,e,r){const o=r??new t(12),i=n[0],s=n[1],a=n[2],c=n[4],u=n[5],h=n[6],f=Math.cos(e),l=Math.sin(e);return o[0]=f*i+l*c,o[1]=f*s+l*u,o[2]=f*a+l*h,o[4]=f*c-l*i,o[5]=f*u-l*s,o[6]=f*h-l*a,n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10]),o},scaling:function(n,e){const r=e??new t(12);return r[0]=n[0],r[1]=0,r[2]=0,r[4]=0,r[5]=n[1],r[6]=0,r[8]=0,r[9]=0,r[10]=1,r},scale:function(n,e,r){const o=r??new t(12),i=e[0],s=e[1];return o[0]=i*n[0],o[1]=i*n[1],o[2]=i*n[2],o[4]=s*n[4],o[5]=s*n[5],o[6]=s*n[6],n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10]),o},uniformScaling:function(n,e){const r=e??new t(12);return r[0]=n,r[1]=0,r[2]=0,r[4]=0,r[5]=n,r[6]=0,r[8]=0,r[9]=0,r[10]=1,r},uniformScale:function(n,e,r){const o=r??new t(12);return o[0]=e*n[0],o[1]=e*n[1],o[2]=e*n[2],o[4]=e*n[4],o[5]=e*n[5],o[6]=e*n[6],n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10]),o}}}(t),f.set(t,n)),n}const d=new Map;function M(t){let n=d.get(t);return n||(n=function(t){const n=h(t);function e(n,e){const r=e??new t(16);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r}const r=e;function o(n){const e=n??new t(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function i(n,e){const r=e??new t(16),o=n[0],i=n[1],s=n[2],a=n[3],c=n[4],u=n[5],h=n[6],f=n[7],l=n[8],d=n[9],M=n[10],w=n[11],m=n[12],p=n[13],v=n[14],g=n[15],b=M*g,x=v*w,y=h*g,q=v*f,A=h*w,B=M*f,P=s*g,S=v*a,U=s*w,z=M*a,F=s*f,G=h*a,j=l*p,C=m*d,R=c*p,L=m*u,V=c*d,D=l*u,O=o*p,k=m*i,E=o*d,I=l*i,X=o*u,Y=c*i,T=b*u+q*d+A*p-(x*u+y*d+B*p),W=x*i+P*d+z*p-(b*i+S*d+U*p),_=y*i+S*u+F*p-(q*i+P*u+G*p),Z=B*i+U*u+G*d-(A*i+z*u+F*d),K=1/(o*T+c*W+l*_+m*Z);return r[0]=K*T,r[1]=K*W,r[2]=K*_,r[3]=K*Z,r[4]=K*(x*c+y*l+B*m-(b*c+q*l+A*m)),r[5]=K*(b*o+S*l+U*m-(x*o+P*l+z*m)),r[6]=K*(q*o+P*c+G*m-(y*o+S*c+F*m)),r[7]=K*(A*o+z*c+F*l-(B*o+U*c+G*l)),r[8]=K*(j*f+L*w+V*g-(C*f+R*w+D*g)),r[9]=K*(C*a+O*w+I*g-(j*a+k*w+E*g)),r[10]=K*(R*a+k*f+X*g-(L*a+O*f+Y*g)),r[11]=K*(D*a+E*f+Y*w-(V*a+I*f+X*w)),r[12]=K*(R*M+D*v+C*h-(V*v+j*h+L*M)),r[13]=K*(E*v+j*s+k*M-(O*M+I*v+C*s)),r[14]=K*(O*h+Y*v+L*s-(X*v+R*s+k*h)),r[15]=K*(X*M+V*s+I*h-(E*h+Y*M+D*s)),r}const a=i;function c(n,e,r){const o=r??new t(16),i=n[0],s=n[1],a=n[2],c=n[3],u=n[4],h=n[5],f=n[6],l=n[7],d=n[8],M=n[9],w=n[10],m=n[11],p=n[12],v=n[13],g=n[14],b=n[15],x=e[0],y=e[1],q=e[2],A=e[3],B=e[4],P=e[5],S=e[6],U=e[7],z=e[8],F=e[9],G=e[10],j=e[11],C=e[12],R=e[13],L=e[14],V=e[15];return o[0]=i*x+u*y+d*q+p*A,o[1]=s*x+h*y+M*q+v*A,o[2]=a*x+f*y+w*q+g*A,o[3]=c*x+l*y+m*q+b*A,o[4]=i*B+u*P+d*S+p*U,o[5]=s*B+h*P+M*S+v*U,o[6]=a*B+f*P+w*S+g*U,o[7]=c*B+l*P+m*S+b*U,o[8]=i*z+u*F+d*G+p*j,o[9]=s*z+h*F+M*G+v*j,o[10]=a*z+f*F+w*G+g*j,o[11]=c*z+l*F+m*G+b*j,o[12]=i*C+u*R+d*L+p*V,o[13]=s*C+h*R+M*L+v*V,o[14]=a*C+f*R+w*L+g*V,o[15]=c*C+l*R+m*L+b*V,o}const u=c,f=n.create(),l=n.create(),d=n.create();function M(n,e,r){const o=r??new t(16);let i=n[0],s=n[1],a=n[2];const c=Math.sqrt(i*i+s*s+a*a);i/=c,s/=c,a/=c;const u=i*i,h=s*s,f=a*a,l=Math.cos(e),d=Math.sin(e),M=1-l;return o[0]=u+(1-u)*l,o[1]=i*s*M+a*d,o[2]=i*a*M-s*d,o[3]=0,o[4]=i*s*M-a*d,o[5]=h+(1-h)*l,o[6]=s*a*M+i*d,o[7]=0,o[8]=i*a*M+s*d,o[9]=s*a*M-i*d,o[10]=f+(1-f)*l,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function w(n,e,r,o){const i=o??new t(16);let s=e[0],a=e[1],c=e[2];const u=Math.sqrt(s*s+a*a+c*c);s/=u,a/=u,c/=u;const h=s*s,f=a*a,l=c*c,d=Math.cos(r),M=Math.sin(r),w=1-d,m=h+(1-h)*d,p=s*a*w+c*M,v=s*c*w-a*M,g=s*a*w-c*M,b=f+(1-f)*d,x=a*c*w+s*M,y=s*c*w+a*M,q=a*c*w-s*M,A=l+(1-l)*d,B=n[0],P=n[1],S=n[2],U=n[3],z=n[4],F=n[5],G=n[6],j=n[7],C=n[8],R=n[9],L=n[10],V=n[11];return i[0]=m*B+p*z+v*C,i[1]=m*P+p*F+v*R,i[2]=m*S+p*G+v*L,i[3]=m*U+p*j+v*V,i[4]=g*B+b*z+x*C,i[5]=g*P+b*F+x*R,i[6]=g*S+b*G+x*L,i[7]=g*U+b*j+x*V,i[8]=y*B+q*z+A*C,i[9]=y*P+q*F+A*R,i[10]=y*S+q*G+A*L,i[11]=y*U+q*j+A*V,n!==i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i}return{create:function(n,e,r,o,i,s,a,c,u,h,f,l,d,M,w,m){const p=new t(16);return void 0!==n&&(p[0]=n,void 0!==e&&(p[1]=e,void 0!==r&&(p[2]=r,void 0!==o&&(p[3]=o,void 0!==i&&(p[4]=i,void 0!==s&&(p[5]=s,void 0!==a&&(p[6]=a,void 0!==c&&(p[7]=c,void 0!==u&&(p[8]=u,void 0!==h&&(p[9]=h,void 0!==f&&(p[10]=f,void 0!==l&&(p[11]=l,void 0!==d&&(p[12]=d,void 0!==M&&(p[13]=M,void 0!==w&&(p[14]=w,void 0!==m&&(p[15]=m)))))))))))))))),p},set:function(n,e,r,o,i,s,a,c,u,h,f,l,d,M,w,m,p){const v=p??new t(16);return v[0]=n,v[1]=e,v[2]=r,v[3]=o,v[4]=i,v[5]=s,v[6]=a,v[7]=c,v[8]=u,v[9]=h,v[10]=f,v[11]=l,v[12]=d,v[13]=M,v[14]=w,v[15]=m,v},fromMat3:function(n,e){const r=e??new t(16);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=0,r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},fromQuat:function(n,e){const r=e??new t(16),o=n[0],i=n[1],s=n[2],a=n[3],c=o+o,u=i+i,h=s+s,f=o*c,l=i*c,d=i*u,M=s*c,w=s*u,m=s*h,p=a*c,v=a*u,g=a*h;return r[0]=1-d-m,r[1]=l+g,r[2]=M-v,r[3]=0,r[4]=l-g,r[5]=1-f-m,r[6]=w+p,r[7]=0,r[8]=M+v,r[9]=w-p,r[10]=1-f-d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},negate:function(n,e){const r=e??new t(16);return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=-n[3],r[4]=-n[4],r[5]=-n[5],r[6]=-n[6],r[7]=-n[7],r[8]=-n[8],r[9]=-n[9],r[10]=-n[10],r[11]=-n[11],r[12]=-n[12],r[13]=-n[13],r[14]=-n[14],r[15]=-n[15],r},copy:e,clone:r,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s&&Math.abs(t[2]-n[2])<s&&Math.abs(t[3]-n[3])<s&&Math.abs(t[4]-n[4])<s&&Math.abs(t[5]-n[5])<s&&Math.abs(t[6]-n[6])<s&&Math.abs(t[7]-n[7])<s&&Math.abs(t[8]-n[8])<s&&Math.abs(t[9]-n[9])<s&&Math.abs(t[10]-n[10])<s&&Math.abs(t[11]-n[11])<s&&Math.abs(t[12]-n[12])<s&&Math.abs(t[13]-n[13])<s&&Math.abs(t[14]-n[14])<s&&Math.abs(t[15]-n[15])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]},identity:o,transpose:function(n,e){const r=e??new t(16);if(r===n){let t;return t=n[1],n[1]=n[4],n[4]=t,t=n[2],n[2]=n[8],n[8]=t,t=n[3],n[3]=n[12],n[12]=t,t=n[6],n[6]=n[9],n[9]=t,t=n[7],n[7]=n[13],n[13]=t,t=n[11],n[11]=n[14],n[14]=t,r}const o=n[0],i=n[1],s=n[2],a=n[3],c=n[4],u=n[5],h=n[6],f=n[7],l=n[8],d=n[9],M=n[10],w=n[11],m=n[12],p=n[13],v=n[14],g=n[15];return r[0]=o,r[1]=c,r[2]=l,r[3]=m,r[4]=i,r[5]=u,r[6]=d,r[7]=p,r[8]=s,r[9]=h,r[10]=M,r[11]=v,r[12]=a,r[13]=f,r[14]=w,r[15]=g,r},inverse:i,determinant:function(t){const n=t[0],e=t[1],r=t[2],o=t[3],i=t[4],s=t[5],a=t[6],c=t[7],u=t[8],h=t[9],f=t[10],l=t[11],d=t[12],M=t[13],w=t[14],m=t[15],p=f*m,v=w*l,g=a*m,b=w*c,x=a*l,y=f*c,q=r*m,A=w*o,B=r*l,P=f*o,S=r*c,U=a*o;return n*(p*s+b*h+x*M-(v*s+g*h+y*M))+i*(v*e+q*h+P*M-(p*e+A*h+B*M))+u*(g*e+A*s+S*M-(b*e+q*s+U*M))+d*(y*e+B*s+U*h-(x*e+P*s+S*h))},invert:a,multiply:c,mul:u,setTranslation:function(t,n,e){const r=e??o();return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11]),r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r},getTranslation:function(t,e){const r=e??n.create();return r[0]=t[12],r[1]=t[13],r[2]=t[14],r},getAxis:function(t,e,r){const o=r??n.create(),i=4*e;return o[0]=t[i+0],o[1]=t[i+1],o[2]=t[i+2],o},setAxis:function(t,n,r,o){const i=o===t?o:e(t,o),s=4*r;return i[s+0]=n[0],i[s+1]=n[1],i[s+2]=n[2],i},getScaling:function(t,e){const r=e??n.create(),o=t[0],i=t[1],s=t[2],a=t[4],c=t[5],u=t[6],h=t[8],f=t[9],l=t[10];return r[0]=Math.sqrt(o*o+i*i+s*s),r[1]=Math.sqrt(a*a+c*c+u*u),r[2]=Math.sqrt(h*h+f*f+l*l),r},perspective:function(n,e,r,o,i){const s=i??new t(16),a=Math.tan(.5*Math.PI-.5*n);if(s[0]=a/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,Number.isFinite(o)){const t=1/(r-o);s[10]=o*t,s[14]=o*r*t}else s[10]=-1,s[14]=-r;return s},perspectiveReverseZ:function(n,e,r,o=1/0,i){const s=i??new t(16),a=1/Math.tan(.5*n);if(s[0]=a/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,o===1/0)s[10]=0,s[14]=r;else{const t=1/(o-r);s[10]=r*t,s[14]=o*r*t}return s},ortho:function(n,e,r,o,i,s,a){const c=a??new t(16);return c[0]=2/(e-n),c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2/(o-r),c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1/(i-s),c[11]=0,c[12]=(e+n)/(n-e),c[13]=(o+r)/(r-o),c[14]=i/(i-s),c[15]=1,c},frustum:function(n,e,r,o,i,s,a){const c=a??new t(16),u=e-n,h=o-r,f=i-s;return c[0]=2*i/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2*i/h,c[6]=0,c[7]=0,c[8]=(n+e)/u,c[9]=(o+r)/h,c[10]=s/f,c[11]=-1,c[12]=0,c[13]=0,c[14]=i*s/f,c[15]=0,c},frustumReverseZ:function(n,e,r,o,i,s=1/0,a){const c=a??new t(16),u=e-n,h=o-r;if(c[0]=2*i/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2*i/h,c[6]=0,c[7]=0,c[8]=(n+e)/u,c[9]=(o+r)/h,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,s===1/0)c[10]=0,c[14]=i;else{const t=1/(s-i);c[10]=i*t,c[14]=s*i*t}return c},aim:function(e,r,o,i){const s=i??new t(16);return n.normalize(n.subtract(r,e,d),d),n.normalize(n.cross(o,d,f),f),n.normalize(n.cross(d,f,l),l),s[0]=f[0],s[1]=f[1],s[2]=f[2],s[3]=0,s[4]=l[0],s[5]=l[1],s[6]=l[2],s[7]=0,s[8]=d[0],s[9]=d[1],s[10]=d[2],s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s},cameraAim:function(e,r,o,i){const s=i??new t(16);return n.normalize(n.subtract(e,r,d),d),n.normalize(n.cross(o,d,f),f),n.normalize(n.cross(d,f,l),l),s[0]=f[0],s[1]=f[1],s[2]=f[2],s[3]=0,s[4]=l[0],s[5]=l[1],s[6]=l[2],s[7]=0,s[8]=d[0],s[9]=d[1],s[10]=d[2],s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s},lookAt:function(e,r,o,i){const s=i??new t(16);return n.normalize(n.subtract(e,r,d),d),n.normalize(n.cross(o,d,f),f),n.normalize(n.cross(d,f,l),l),s[0]=f[0],s[1]=l[0],s[2]=d[0],s[3]=0,s[4]=f[1],s[5]=l[1],s[6]=d[1],s[7]=0,s[8]=f[2],s[9]=l[2],s[10]=d[2],s[11]=0,s[12]=-(f[0]*e[0]+f[1]*e[1]+f[2]*e[2]),s[13]=-(l[0]*e[0]+l[1]*e[1]+l[2]*e[2]),s[14]=-(d[0]*e[0]+d[1]*e[1]+d[2]*e[2]),s[15]=1,s},translation:function(n,e){const r=e??new t(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r},translate:function(n,e,r){const o=r??new t(16),i=e[0],s=e[1],a=e[2],c=n[0],u=n[1],h=n[2],f=n[3],l=n[4],d=n[5],M=n[6],w=n[7],m=n[8],p=n[9],v=n[10],g=n[11],b=n[12],x=n[13],y=n[14],q=n[15];return n!==o&&(o[0]=c,o[1]=u,o[2]=h,o[3]=f,o[4]=l,o[5]=d,o[6]=M,o[7]=w,o[8]=m,o[9]=p,o[10]=v,o[11]=g),o[12]=c*i+l*s+m*a+b,o[13]=u*i+d*s+p*a+x,o[14]=h*i+M*s+v*a+y,o[15]=f*i+w*s+g*a+q,o},rotationX:function(n,e){const r=e??new t(16),o=Math.cos(n),i=Math.sin(n);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=i,r[7]=0,r[8]=0,r[9]=-i,r[10]=o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotateX:function(n,e,r){const o=r??new t(16),i=n[4],s=n[5],a=n[6],c=n[7],u=n[8],h=n[9],f=n[10],l=n[11],d=Math.cos(e),M=Math.sin(e);return o[4]=d*i+M*u,o[5]=d*s+M*h,o[6]=d*a+M*f,o[7]=d*c+M*l,o[8]=d*u-M*i,o[9]=d*h-M*s,o[10]=d*f-M*a,o[11]=d*l-M*c,n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o},rotationY:function(n,e){const r=e??new t(16),o=Math.cos(n),i=Math.sin(n);return r[0]=o,r[1]=0,r[2]=-i,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=i,r[9]=0,r[10]=o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotateY:function(n,e,r){const o=r??new t(16),i=n[0],s=n[1],a=n[2],c=n[3],u=n[8],h=n[9],f=n[10],l=n[11],d=Math.cos(e),M=Math.sin(e);return o[0]=d*i-M*u,o[1]=d*s-M*h,o[2]=d*a-M*f,o[3]=d*c-M*l,o[8]=d*u+M*i,o[9]=d*h+M*s,o[10]=d*f+M*a,o[11]=d*l+M*c,n!==o&&(o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o},rotationZ:function(n,e){const r=e??new t(16),o=Math.cos(n),i=Math.sin(n);return r[0]=o,r[1]=i,r[2]=0,r[3]=0,r[4]=-i,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotateZ:function(n,e,r){const o=r??new t(16),i=n[0],s=n[1],a=n[2],c=n[3],u=n[4],h=n[5],f=n[6],l=n[7],d=Math.cos(e),M=Math.sin(e);return o[0]=d*i+M*u,o[1]=d*s+M*h,o[2]=d*a+M*f,o[3]=d*c+M*l,o[4]=d*u-M*i,o[5]=d*h-M*s,o[6]=d*f-M*a,o[7]=d*l-M*c,n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o},axisRotation:M,rotation:M,axisRotate:w,rotate:w,scaling:function(n,e){const r=e??new t(16);return r[0]=n[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=n[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},scale:function(n,e,r){const o=r??new t(16),i=e[0],s=e[1],a=e[2];return o[0]=i*n[0],o[1]=i*n[1],o[2]=i*n[2],o[3]=i*n[3],o[4]=s*n[4],o[5]=s*n[5],o[6]=s*n[6],o[7]=s*n[7],o[8]=a*n[8],o[9]=a*n[9],o[10]=a*n[10],o[11]=a*n[11],n!==o&&(o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o},uniformScaling:function(n,e){const r=e??new t(16);return r[0]=n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},uniformScale:function(n,e,r){const o=r??new t(16);return o[0]=e*n[0],o[1]=e*n[1],o[2]=e*n[2],o[3]=e*n[3],o[4]=e*n[4],o[5]=e*n[5],o[6]=e*n[6],o[7]=e*n[7],o[8]=e*n[8],o[9]=e*n[9],o[10]=e*n[10],o[11]=e*n[11],n!==o&&(o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o}}}(t),d.set(t,n)),n}const w=new Map;function m(t){let n=w.get(t);return n||(n=function(t){const n=h(t);function e(n,e,r,o){const i=new t(4);return void 0!==n&&(i[0]=n,void 0!==e&&(i[1]=e,void 0!==r&&(i[2]=r,void 0!==o&&(i[3]=o)))),i}const r=e;function o(n,e,r){const o=r??new t(4),i=.5*e,s=Math.sin(i);return o[0]=s*n[0],o[1]=s*n[1],o[2]=s*n[2],o[3]=Math.cos(i),o}function i(n,e,r){const o=r??new t(4),i=n[0],s=n[1],a=n[2],c=n[3],u=e[0],h=e[1],f=e[2],l=e[3];return o[0]=i*l+c*u+s*f-a*h,o[1]=s*l+c*h+a*u-i*f,o[2]=a*l+c*f+i*h-s*u,o[3]=c*l-i*u-s*h-a*f,o}const a=i;function c(n,e,r,o){const i=o??new t(4),a=n[0],c=n[1],u=n[2],h=n[3];let f,l,d=e[0],M=e[1],w=e[2],m=e[3],p=a*d+c*M+u*w+h*m;if(p<0&&(p=-p,d=-d,M=-M,w=-w,m=-m),1-p>s){const t=Math.acos(p),n=Math.sin(t);f=Math.sin((1-r)*t)/n,l=Math.sin(r*t)/n}else f=1-r,l=r;return i[0]=f*a+l*d,i[1]=f*c+l*M,i[2]=f*u+l*w,i[3]=f*h+l*m,i}function u(n,e){const r=e??new t(4);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r}const f=u;function l(n,e,r){const o=r??new t(4);return o[0]=n[0]-e[0],o[1]=n[1]-e[1],o[2]=n[2]-e[2],o[3]=n[3]-e[3],o}const d=l;function M(n,e,r){const o=r??new t(4);return o[0]=n[0]*e,o[1]=n[1]*e,o[2]=n[2]*e,o[3]=n[3]*e,o}const w=M;function m(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function p(t){const n=t[0],e=t[1],r=t[2],o=t[3];return Math.sqrt(n*n+e*e+r*r+o*o)}const v=p;function g(t){const n=t[0],e=t[1],r=t[2],o=t[3];return n*n+e*e+r*r+o*o}const b=g;function x(n,e){const r=e??new t(4),o=n[0],i=n[1],s=n[2],a=n[3],c=Math.sqrt(o*o+i*i+s*s+a*a);return c>1e-5?(r[0]=o/c,r[1]=i/c,r[2]=s/c,r[3]=a/c):(r[0]=0,r[1]=0,r[2]=0,r[3]=1),r}const y=n.create(),q=n.create(),A=n.create(),B=new t(4),P=new t(4);return{create:e,fromValues:r,set:function(n,e,r,o,i){const s=i??new t(4);return s[0]=n,s[1]=e,s[2]=r,s[3]=o,s},fromAxisAngle:o,toAxisAngle:function(t,e){const r=e??n.create(3),o=2*Math.acos(t[3]),i=Math.sin(.5*o);return i>s?(r[0]=t[0]/i,r[1]=t[1]/i,r[2]=t[2]/i):(r[0]=1,r[1]=0,r[2]=0),{angle:o,axis:r}},angle:function(t,n){const e=m(t,n);return Math.acos(2*e*e-1)},multiply:i,mul:a,rotateX:function(n,e,r){const o=r??new t(4),i=.5*e,s=n[0],a=n[1],c=n[2],u=n[3],h=Math.sin(i),f=Math.cos(i);return o[0]=s*f+u*h,o[1]=a*f+c*h,o[2]=c*f-a*h,o[3]=u*f-s*h,o},rotateY:function(n,e,r){const o=r??new t(4),i=.5*e,s=n[0],a=n[1],c=n[2],u=n[3],h=Math.sin(i),f=Math.cos(i);return o[0]=s*f-c*h,o[1]=a*f+u*h,o[2]=c*f+s*h,o[3]=u*f-a*h,o},rotateZ:function(n,e,r){const o=r??new t(4),i=.5*e,s=n[0],a=n[1],c=n[2],u=n[3],h=Math.sin(i),f=Math.cos(i);return o[0]=s*f+a*h,o[1]=a*f-s*h,o[2]=c*f+u*h,o[3]=u*f-c*h,o},slerp:c,inverse:function(n,e){const r=e??new t(4),o=n[0],i=n[1],s=n[2],a=n[3],c=o*o+i*i+s*s+a*a,u=c?1/c:0;return r[0]=-o*u,r[1]=-i*u,r[2]=-s*u,r[3]=a*u,r},conjugate:function(n,e){const r=e??new t(4);return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=n[3],r},fromMat:function(n,e){const r=e??new t(4),o=n[0]+n[5]+n[10];if(o>0){const t=Math.sqrt(o+1);r[3]=.5*t;const e=.5/t;r[0]=(n[6]-n[9])*e,r[1]=(n[8]-n[2])*e,r[2]=(n[1]-n[4])*e}else{let t=0;n[5]>n[0]&&(t=1),n[10]>n[4*t+t]&&(t=2);const e=(t+1)%3,o=(t+2)%3,i=Math.sqrt(n[4*t+t]-n[4*e+e]-n[4*o+o]+1);r[t]=.5*i;const s=.5/i;r[3]=(n[4*e+o]-n[4*o+e])*s,r[e]=(n[4*e+t]+n[4*t+e])*s,r[o]=(n[4*o+t]+n[4*t+o])*s}return r},fromEuler:function(n,e,r,o,i){const s=i??new t(4),a=.5*n,c=.5*e,u=.5*r,h=Math.sin(a),f=Math.cos(a),l=Math.sin(c),d=Math.cos(c),M=Math.sin(u),w=Math.cos(u);switch(o){case"xyz":s[0]=h*d*w+f*l*M,s[1]=f*l*w-h*d*M,s[2]=f*d*M+h*l*w,s[3]=f*d*w-h*l*M;break;case"xzy":s[0]=h*d*w-f*l*M,s[1]=f*l*w-h*d*M,s[2]=f*d*M+h*l*w,s[3]=f*d*w+h*l*M;break;case"yxz":s[0]=h*d*w+f*l*M,s[1]=f*l*w-h*d*M,s[2]=f*d*M-h*l*w,s[3]=f*d*w+h*l*M;break;case"yzx":s[0]=h*d*w+f*l*M,s[1]=f*l*w+h*d*M,s[2]=f*d*M-h*l*w,s[3]=f*d*w-h*l*M;break;case"zxy":s[0]=h*d*w-f*l*M,s[1]=f*l*w+h*d*M,s[2]=f*d*M+h*l*w,s[3]=f*d*w-h*l*M;break;case"zyx":s[0]=h*d*w-f*l*M,s[1]=f*l*w+h*d*M,s[2]=f*d*M-h*l*w,s[3]=f*d*w+h*l*M;break;default:throw new Error(`Unknown rotation order: ${o}`)}return s},copy:u,clone:f,add:function(n,e,r){const o=r??new t(4);return o[0]=n[0]+e[0],o[1]=n[1]+e[1],o[2]=n[2]+e[2],o[3]=n[3]+e[3],o},subtract:l,sub:d,mulScalar:M,scale:w,divScalar:function(n,e,r){const o=r??new t(4);return o[0]=n[0]/e,o[1]=n[1]/e,o[2]=n[2]/e,o[3]=n[3]/e,o},dot:m,lerp:function(n,e,r,o){const i=o??new t(4);return i[0]=n[0]+r*(e[0]-n[0]),i[1]=n[1]+r*(e[1]-n[1]),i[2]=n[2]+r*(e[2]-n[2]),i[3]=n[3]+r*(e[3]-n[3]),i},length:p,len:v,lengthSq:g,lenSq:b,normalize:x,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s&&Math.abs(t[2]-n[2])<s&&Math.abs(t[3]-n[3])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},identity:function(n){const e=n??new t(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},rotationTo:function(e,r,i){const s=i??new t(4),a=n.dot(e,r);return a<-.999999?(n.cross(q,e,y),n.len(y)<1e-6&&n.cross(A,e,y),n.normalize(y,y),o(y,Math.PI,s),s):a>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(n.cross(e,r,y),s[0]=y[0],s[1]=y[1],s[2]=y[2],s[3]=1+a,x(s,s))},sqlerp:function(n,e,r,o,i,s){const a=s??new t(4);return c(n,o,i,B),c(e,r,i,P),c(B,P,2*i*(1-i),a),a}}}(t),w.set(t,n)),n}const p=new Map;function v(t){let n=p.get(t);return n||(n=function(t){function n(n,e,r,o){const i=new t(4);return void 0!==n&&(i[0]=n,void 0!==e&&(i[1]=e,void 0!==r&&(i[2]=r,void 0!==o&&(i[3]=o)))),i}function e(n,e,r){const o=r??new t(4);return o[0]=n[0]-e[0],o[1]=n[1]-e[1],o[2]=n[2]-e[2],o[3]=n[3]-e[3],o}function r(n,e,r,o){const i=o??new t(4);return i[0]=n[0]+r*(e[0]-n[0]),i[1]=n[1]+r*(e[1]-n[1]),i[2]=n[2]+r*(e[2]-n[2]),i[3]=n[3]+r*(e[3]-n[3]),i}function o(n,e,r){const o=r??new t(4);return o[0]=n[0]*e,o[1]=n[1]*e,o[2]=n[2]*e,o[3]=n[3]*e,o}function i(n,e){const r=e??new t(4);return r[0]=1/n[0],r[1]=1/n[1],r[2]=1/n[2],r[3]=1/n[3],r}function a(t){const n=t[0],e=t[1],r=t[2],o=t[3];return Math.sqrt(n*n+e*e+r*r+o*o)}function c(t){const n=t[0],e=t[1],r=t[2],o=t[3];return n*n+e*e+r*r+o*o}function u(t,n){const e=t[0]-n[0],r=t[1]-n[1],o=t[2]-n[2],i=t[3]-n[3];return Math.sqrt(e*e+r*r+o*o+i*i)}function h(t,n){const e=t[0]-n[0],r=t[1]-n[1],o=t[2]-n[2],i=t[3]-n[3];return e*e+r*r+o*o+i*i}function f(n,e){const r=e??new t(4),o=n[0],i=n[1],s=n[2],a=n[3],c=Math.sqrt(o*o+i*i+s*s+a*a);return c>1e-5?(r[0]=o/c,r[1]=i/c,r[2]=s/c,r[3]=a/c):(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function l(n,e){const r=e??new t(4);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r}function d(n,e,r){const o=r??new t(4);return o[0]=n[0]*e[0],o[1]=n[1]*e[1],o[2]=n[2]*e[2],o[3]=n[3]*e[3],o}function M(n,e,r){const o=r??new t(4);return o[0]=n[0]/e[0],o[1]=n[1]/e[1],o[2]=n[2]/e[2],o[3]=n[3]/e[3],o}function w(n,e,r){const i=r??new t(4);return f(n,i),o(i,e,i)}return{create:n,fromValues:n,set:function(n,e,r,o,i){const s=i??new t(4);return s[0]=n,s[1]=e,s[2]=r,s[3]=o,s},ceil:function(n,e){const r=e??new t(4);return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r[2]=Math.ceil(n[2]),r[3]=Math.ceil(n[3]),r},floor:function(n,e){const r=e??new t(4);return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r[2]=Math.floor(n[2]),r[3]=Math.floor(n[3]),r},round:function(n,e){const r=e??new t(4);return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r[2]=Math.round(n[2]),r[3]=Math.round(n[3]),r},clamp:function(n,e=0,r=1,o){const i=o??new t(4);return i[0]=Math.min(r,Math.max(e,n[0])),i[1]=Math.min(r,Math.max(e,n[1])),i[2]=Math.min(r,Math.max(e,n[2])),i[3]=Math.min(r,Math.max(e,n[3])),i},add:function(n,e,r){const o=r??new t(4);return o[0]=n[0]+e[0],o[1]=n[1]+e[1],o[2]=n[2]+e[2],o[3]=n[3]+e[3],o},addScaled:function(n,e,r,o){const i=o??new t(4);return i[0]=n[0]+e[0]*r,i[1]=n[1]+e[1]*r,i[2]=n[2]+e[2]*r,i[3]=n[3]+e[3]*r,i},subtract:e,sub:e,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s&&Math.abs(t[2]-n[2])<s&&Math.abs(t[3]-n[3])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},lerp:r,lerpV:function(n,e,r,o){const i=o??new t(4);return i[0]=n[0]+r[0]*(e[0]-n[0]),i[1]=n[1]+r[1]*(e[1]-n[1]),i[2]=n[2]+r[2]*(e[2]-n[2]),i[3]=n[3]+r[3]*(e[3]-n[3]),i},max:function(n,e,r){const o=r??new t(4);return o[0]=Math.max(n[0],e[0]),o[1]=Math.max(n[1],e[1]),o[2]=Math.max(n[2],e[2]),o[3]=Math.max(n[3],e[3]),o},min:function(n,e,r){const o=r??new t(4);return o[0]=Math.min(n[0],e[0]),o[1]=Math.min(n[1],e[1]),o[2]=Math.min(n[2],e[2]),o[3]=Math.min(n[3],e[3]),o},mulScalar:o,scale:o,divScalar:function(n,e,r){const o=r??new t(4);return o[0]=n[0]/e,o[1]=n[1]/e,o[2]=n[2]/e,o[3]=n[3]/e,o},inverse:i,invert:i,dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},length:a,len:a,lengthSq:c,lenSq:c,distance:u,dist:u,distanceSq:h,distSq:h,normalize:f,negate:function(n,e){const r=e??new t(4);return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=-n[3],r},copy:l,clone:l,multiply:d,mul:d,divide:M,div:M,zero:function(n){const e=n??new t(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},transformMat4:function(n,e,r){const o=r??new t(4),i=n[0],s=n[1],a=n[2],c=n[3];return o[0]=e[0]*i+e[4]*s+e[8]*a+e[12]*c,o[1]=e[1]*i+e[5]*s+e[9]*a+e[13]*c,o[2]=e[2]*i+e[6]*s+e[10]*a+e[14]*c,o[3]=e[3]*i+e[7]*s+e[11]*a+e[15]*c,o},setLength:w,truncate:function(n,e,r){const o=r??new t(4);return a(n)>e?w(n,e,o):l(n,o)},midpoint:function(n,e,o){return r(n,e,.5,o??new t(4))}}}(t),p.set(t,n)),n}function g(t,n,e,r,o,i){return{mat3:l(t),mat4:M(n),quat:m(e),vec2:c(r),vec3:h(o),vec4:v(i)}}const{mat3:b,mat4:x,quat:y,vec2:q,vec3:A,vec4:B}=g(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);g(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array),g(r,Array,Array,Array,Array,Array);class P{position;target;up;viewMatrix;projectionMatrix;fov;aspectRatio;near;far;orientation=y.create();distance;angularVelocity=.01;axis=A.create();constructor(t,n,e,r,o,i,s){this.position=new Float32Array(t),this.target=new Float32Array(n),this.up=new Float32Array(e),this.fov=r*Math.PI/180,this.aspectRatio=o,this.near=i,this.far=s,this.distance=A.length(A.subtract(new Float32Array(3),t,n)),this.viewMatrix=x.lookAt(this.position,this.target,this.up),this.projectionMatrix=x.perspective(this.fov,this.aspectRatio,this.near,this.far)}updateViewMatrix(){x.lookAt(this.position,this.target,this.up,this.viewMatrix)}setAspectRatio(t){this.aspectRatio=t,this.updateProjectionMatrix()}setPosition(t){this.position=new Float32Array(t),this.updateViewMatrix()}updateProjectionMatrix(){x.perspective(this.fov,this.aspectRatio,this.near,this.far,this.projectionMatrix)}move(t){A.add(this.position,t,this.position),this.updateViewMatrix()}}class S{camera;canvas;isMouseDown=!1;lastMouseX=null;lastMouseY=null;mouseDelta={x:0,y:0};constructor(t,n){this.camera=t,this.canvas=n,this.addKeyboardListeners(),this.addMouseListeners()}addKeyboardListeners(){window.addEventListener("keydown",this.handleKeyDown)}addMouseListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("mousemove",this.handleMouseMove)}handleMouseDown=t=>{this.isMouseDown=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY};handleMouseUp=()=>{this.isMouseDown=!1};handleMouseMove=t=>{if(!this.isMouseDown)return;const n=t.clientX-(this.lastMouseX||t.clientX),e=t.clientY-(this.lastMouseY||t.clientY);this.mouseDelta.x+=n,this.mouseDelta.y+=e,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,console.log(n,e)};updateCameraOrbit(t){let n=Math.sqrt(this.camera.position[0]**2+this.camera.position[1]**2+this.camera.position[2]**2),e=Math.atan2(this.camera.position[0],this.camera.position[2]),r=Math.acos(this.camera.position[1]/n);e-=this.mouseDelta.x*t*.5,r-=this.mouseDelta.y*t*.5,r=Math.max(.1,Math.min(Math.PI-.1,r)),this.camera.setPosition([n*Math.sin(r)*Math.sin(e),n*Math.cos(r),n*Math.sin(r)*Math.cos(e)]),this.mouseDelta.x=0,this.mouseDelta.y=0}handleKeyDown=t=>{switch(t.key){case"ArrowUp":case"w":this.moveCamera([0,0,-.1]);break;case"ArrowDown":case"s":this.moveCamera([0,0,.1]);break;case"ArrowLeft":case"a":this.moveCamera([-.1,0,0]);break;case"ArrowRight":case"d":this.moveCamera([.1,0,0]);break;case"q":this.moveCamera([0,.1,0]);break;case"e":this.moveCamera([0,-.1,0])}t.preventDefault()};moveCamera(t){this.camera.move(t)}}class U{canvas;context;device;swapChainFormat="bgra8unorm";scene;camera;cameraControls;constructor(r){this.canvas=document.getElementById(r),this.initializeWebGPU().then((()=>{this.clearCanvas(),this.camera=new P([2,2,2],[0,0,0],[0,1,0],45,this.canvas.width/this.canvas.height,.1,100),this.resizeCanvas(),this.cameraControls=new S(this.camera,this.canvas),this.scene=new t(this.device);const r=new n(this.device,[1,0,0,1],[.5,.5,0]),o=new n(this.device,[1,0,1,1],[0,0,0]),i=new e(this.device,[0,1,0,1],[0,.5,0],.2);this.scene.addObject(r),this.scene.addObject(o),this.scene.addObject(i),this.startRenderingLoop()})).catch((t=>{console.error("Failed to initialize WebGPU:",t)}))}async initializeWebGPU(){if(!navigator.gpu)throw new Error("WebGPU is not supported.");const t=await navigator.gpu.requestAdapter();if(!t)throw new Error("Failed to get GPU adapter.");this.device=await t.requestDevice(),this.context=this.canvas.getContext("webgpu");window.devicePixelRatio;this.canvas.clientWidth,this.canvas.clientHeight;const n={device:this.device,alphaMode:"opaque",format:this.swapChainFormat};this.context.configure(n)}resizeCanvas(){this.canvas.width=this.canvas.clientWidth*window.devicePixelRatio,this.canvas.height=this.canvas.clientHeight*window.devicePixelRatio,this.camera.setAspectRatio(this.canvas.width/this.canvas.height),this.camera.updateProjectionMatrix()}clearCanvas(){const t=this.device.createCommandEncoder(),n={colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:0,g:0,b:0,a:1},storeOp:"store"}]};t.beginRenderPass(n).end();const e=t.finish();this.device.queue.submit([e])}startRenderingLoop(){const t=()=>{this.render(),requestAnimationFrame(t)};requestAnimationFrame(t)}render(){this.camera.updateViewMatrix(),this.camera.updateProjectionMatrix(),this.cameraControls.updateCameraOrbit(.01);const t=this.device.createCommandEncoder(),n={colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:0,g:0,b:0,a:1},storeOp:"store"}]},e=t.beginRenderPass(n);this.scene.draw(e,this.camera),e.end();const r=t.finish();this.device.queue.submit([r])}}(async function(){if(!navigator.gpu)return console.error("WebGPU is not supported on this device!"),!1;try{const t=await navigator.gpu.requestAdapter();if(!t)return console.error("Failed to get GPU adapter!"),!1;if(!await t.requestDevice())return console.error("Failed to get GPU device!"),!1}catch(t){return console.error("An error occurred while initializing WebGPU:",t),!1}return console.log("WebGPU is supported."),!0})().then((t=>{t?(console.log("Loading rendering engine..."),new U("gpuCanvas")):console.log("Rendering engine cannot be loaded due to lack of WebGPU support.")}))}();
//# sourceMappingURL=bundle.js.map
