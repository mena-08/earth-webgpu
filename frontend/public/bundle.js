!function(){"use strict";class t{device;objects;constructor(t){this.device=t,this.objects=[],console.log("Scene created.")}addObject(t){this.objects.push(t)}removeObject(t){const n=this.objects.indexOf(t);n>-1&&this.objects.splice(n,1)}getObjects(){return this.objects}draw(t,n){for(const e of this.objects)e.draw(t,n)}}class n{device;pipeline;vertexBuffer;color;position;uniformBuffer;bindGroup;constructor(t,n,e){this.device=t,this.color=new Float32Array(n),this.position=new Float32Array(e),this.initializeBuffers(),this.createPipeline()}initializeBuffers(){this.createVertexBuffer(),this.createUniformBuffer()}createVertexBuffer(){const t=new Float32Array([0+this.position[0],.5+this.position[1],this.position[2],1,-.5+this.position[0],-.5+this.position[1],this.position[2],1,.5+this.position[0],-.5+this.position[1],this.position[2],1]);this.vertexBuffer=this.device.createBuffer({size:t.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.vertexBuffer.getMappedRange()).set(t),this.vertexBuffer.unmap()}createUniformBuffer(){this.uniformBuffer=this.device.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}createPipeline(){const t=`\n        @fragment\n        fn fs_main() -> @location(0) vec4<f32> {\n            return vec4<f32>(${this.color.join(",")});\n        }`;this.pipeline=this.device.createRenderPipeline({label:"triangle-pipeline",layout:"auto",vertex:{module:this.device.createShaderModule({code:"\n        struct Uniforms {\n    viewMatrix: mat4x4<f32>,\n    projectionMatrix: mat4x4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: Uniforms;\n\n@vertex\nfn vs_main(@location(0) position: vec4<f32>) -> @builtin(position) vec4<f32> {\n    let worldPosition = position;\n    let viewPosition = uniforms.viewMatrix * worldPosition;\n    let clipPosition = uniforms.projectionMatrix * viewPosition;\n    return clipPosition;\n}"}),entryPoint:"vs_main",buffers:[{arrayStride:16,attributes:[{shaderLocation:0,offset:0,format:"float32x4"}]}]},fragment:{module:this.device.createShaderModule({code:t}),entryPoint:"fs_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}}),this.createBindGroup()}createBindGroup(){const t=this.pipeline.getBindGroupLayout(0);this.bindGroup=this.device.createBindGroup({layout:t,entries:[{binding:0,resource:{buffer:this.uniformBuffer,size:128}}]})}draw(t,n){this.device.queue.writeBuffer(this.uniformBuffer,0,n.viewMatrix.buffer,n.viewMatrix.byteOffset,n.viewMatrix.byteLength),this.device.queue.writeBuffer(this.uniformBuffer,64,n.projectionMatrix.buffer,n.projectionMatrix.byteOffset,n.projectionMatrix.byteLength),t.setPipeline(this.pipeline),t.setVertexBuffer(0,this.vertexBuffer),t.setBindGroup(0,this.bindGroup),t.draw(3,1,0,0)}}class e{device;pipeline;vertexBuffer;indexBuffer;color;position;radius=.5;numIndices;uniformBuffer;bindGroup;texture;sampler;constructor(t,n,e,r){this.device=t,this.color=new Float32Array(n),this.position=new Float32Array(e),this.radius=r,this.initializeBuffers(),this.createPipeline()}initializeBuffers(){this.createVertexBuffer(),this.createUniformBuffer()}createVertexBuffer(){const t=128,n=[],e=[];for(let e=0;e<=t;e++){const r=e*Math.PI/t,i=Math.sin(r),o=Math.cos(r);for(let r=0;r<=t;r++){const s=2*r*Math.PI/t,a=Math.sin(s),c=Math.cos(s),u=this.radius*c*i,h=this.radius*o,f=this.radius*a*i;let l=r/t;const d=e/t;l=1-l,n.push(u+this.position[0],h+this.position[1],f+this.position[2],1,l,d)}}for(let n=0;n<t;n++)for(let r=0;r<t;r++){const i=129*n+r,o=i+t+1;e.push(i,o,i+1),e.push(o,o+1,i+1)}this.numIndices=e.length,this.vertexBuffer=this.device.createBuffer({size:4*n.length,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.vertexBuffer.getMappedRange()).set(new Float32Array(n)),this.vertexBuffer.unmap(),this.indexBuffer=this.device.createBuffer({size:4*e.length,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0}),new Uint32Array(this.indexBuffer.getMappedRange()).set(new Uint32Array(e)),this.indexBuffer.unmap()}createUniformBuffer(){this.uniformBuffer=this.device.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}async createPipeline(){this.pipeline=this.device.createRenderPipeline({layout:"auto",label:"sphere-pipeline",vertex:{module:this.device.createShaderModule({code:"\n            struct Uniforms {\n                viewMatrix: mat4x4<f32>,\n                projectionMatrix: mat4x4<f32>,\n            };\n\n            // Define the output structure for vertex shader\n            struct VertexOutput {\n                @builtin(position) position: vec4<f32>,\n                @location(0) uv: vec2<f32>,\n            }\n\n            // Declare the uniform buffer and other resources\n            @group(0) @binding(0) var<uniform> uniforms: Uniforms;\n\n            @vertex\n            fn vs_main(@location(0) position: vec4<f32>, @location(1) uv: vec2<f32>) -> VertexOutput {\n                var output: VertexOutput;\n                let worldPosition = vec4<f32>(position.xyz, 1.0);\n                let viewPosition = uniforms.viewMatrix * worldPosition;\n                let clipPosition = uniforms.projectionMatrix * viewPosition;\n                output.position = clipPosition;\n                output.uv = uv; // Pass the UV coordinates to the fragment shader\n                return output;\n            }"}),entryPoint:"vs_main",buffers:[{arrayStride:24,attributes:[{shaderLocation:0,offset:0,format:"float32x4"},{shaderLocation:1,offset:16,format:"float32x2"}]}]},fragment:{module:this.device.createShaderModule({code:"\n            @group(0) @binding(1) var mySampler: sampler;\n            @group(0) @binding(2) var myTexture: texture_2d<f32>;\n\n            @fragment\n            fn fs_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n                // Use the UV coordinates to sample the texture\n                return textureSample(myTexture, mySampler, uv);\n            }\n        "}),entryPoint:"fs_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}}),this.createBindGroup()}async createBindGroup(){this.texture=await async function(t,n){const e=new Image;e.src=n,await e.decode();const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const i=r.getContext("2d");i.drawImage(e,0,0);const o=i.getImageData(0,0,e.width,e.height),s=t.createTexture({size:[e.width,e.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return t.queue.writeTexture({texture:s},o.data,{bytesPerRow:4*e.width,rowsPerImage:e.height},{width:e.width,height:e.height,depthOrArrayLayers:1}),s}(this.device,"base_map.jpg"),this.sampler=this.device.createSampler({magFilter:"linear",minFilter:"linear",addressModeU:"repeat",addressModeV:"repeat"});const t=this.pipeline.getBindGroupLayout(0);this.bindGroup=this.device.createBindGroup({layout:t,entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:this.sampler},{binding:2,resource:this.texture.createView()}]})}draw(t,n){this.device.queue.writeBuffer(this.uniformBuffer,0,n.viewMatrix.buffer,n.viewMatrix.byteOffset,n.viewMatrix.byteLength),this.device.queue.writeBuffer(this.uniformBuffer,64,n.projectionMatrix.buffer,n.projectionMatrix.byteOffset,n.projectionMatrix.byteLength),t.setPipeline(this.pipeline),t.setVertexBuffer(0,this.vertexBuffer),t.setIndexBuffer(this.indexBuffer,"uint32"),t.setBindGroup(0,this.bindGroup),t.drawIndexed(this.numIndices)}}const r=(i=Array,o=t=>t.fill(0),class extends i{constructor(...t){super(...t),o(this)}});var i,o;let s=1e-6;const a=new Map;function c(t){let n=a.get(t);return n||(n=function(t){function n(n=0,e=0){const r=new t(2);return void 0!==n&&(r[0]=n,void 0!==e&&(r[1]=e)),r}function e(n,e,r){const i=r??new t(2);return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i}function r(n,e,r,i){const o=i??new t(2);return o[0]=n[0]+r*(e[0]-n[0]),o[1]=n[1]+r*(e[1]-n[1]),o}function i(n,e,r){const i=r??new t(2);return i[0]=n[0]*e,i[1]=n[1]*e,i}function o(n,e){const r=e??new t(2);return r[0]=1/n[0],r[1]=1/n[1],r}function a(t,n){return t[0]*n[0]+t[1]*n[1]}function c(t){const n=t[0],e=t[1];return Math.sqrt(n*n+e*e)}function u(t){const n=t[0],e=t[1];return n*n+e*e}function h(t,n){const e=t[0]-n[0],r=t[1]-n[1];return Math.sqrt(e*e+r*r)}function f(t,n){const e=t[0]-n[0],r=t[1]-n[1];return e*e+r*r}function l(n,e){const r=e??new t(2),i=n[0],o=n[1],s=Math.sqrt(i*i+o*o);return s>1e-5?(r[0]=i/s,r[1]=o/s):(r[0]=0,r[1]=0),r}function d(n,e){const r=e??new t(2);return r[0]=n[0],r[1]=n[1],r}function M(n,e,r){const i=r??new t(2);return i[0]=n[0]*e[0],i[1]=n[1]*e[1],i}function w(n,e,r){const i=r??new t(2);return i[0]=n[0]/e[0],i[1]=n[1]/e[1],i}function m(n,e,r){const o=r??new t(2);return l(n,o),i(o,e,o)}return{create:n,fromValues:n,set:function(n,e,r){const i=r??new t(2);return i[0]=n,i[1]=e,i},ceil:function(n,e){const r=e??new t(2);return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r},floor:function(n,e){const r=e??new t(2);return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r},round:function(n,e){const r=e??new t(2);return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r},clamp:function(n,e=0,r=1,i){const o=i??new t(2);return o[0]=Math.min(r,Math.max(e,n[0])),o[1]=Math.min(r,Math.max(e,n[1])),o},add:function(n,e,r){const i=r??new t(2);return i[0]=n[0]+e[0],i[1]=n[1]+e[1],i},addScaled:function(n,e,r,i){const o=i??new t(2);return o[0]=n[0]+e[0]*r,o[1]=n[1]+e[1]*r,o},angle:function(t,n){const e=t[0],r=t[1],i=n[0],o=n[1],s=Math.sqrt(e*e+r*r)*Math.sqrt(i*i+o*o),c=s&&a(t,n)/s;return Math.acos(c)},subtract:e,sub:e,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]},lerp:r,lerpV:function(n,e,r,i){const o=i??new t(2);return o[0]=n[0]+r[0]*(e[0]-n[0]),o[1]=n[1]+r[1]*(e[1]-n[1]),o},max:function(n,e,r){const i=r??new t(2);return i[0]=Math.max(n[0],e[0]),i[1]=Math.max(n[1],e[1]),i},min:function(n,e,r){const i=r??new t(2);return i[0]=Math.min(n[0],e[0]),i[1]=Math.min(n[1],e[1]),i},mulScalar:i,scale:i,divScalar:function(n,e,r){const i=r??new t(2);return i[0]=n[0]/e,i[1]=n[1]/e,i},inverse:o,invert:o,cross:function(n,e,r){const i=r??new t(3),o=n[0]*e[1]-n[1]*e[0];return i[0]=0,i[1]=0,i[2]=o,i},dot:a,length:c,len:c,lengthSq:u,lenSq:u,distance:h,dist:h,distanceSq:f,distSq:f,normalize:l,negate:function(n,e){const r=e??new t(2);return r[0]=-n[0],r[1]=-n[1],r},copy:d,clone:d,multiply:M,mul:M,divide:w,div:w,random:function(n=1,e){const r=e??new t(2),i=2*Math.random()*Math.PI;return r[0]=Math.cos(i)*n,r[1]=Math.sin(i)*n,r},zero:function(n){const e=n??new t(2);return e[0]=0,e[1]=0,e},transformMat4:function(n,e,r){const i=r??new t(2),o=n[0],s=n[1];return i[0]=o*e[0]+s*e[4]+e[12],i[1]=o*e[1]+s*e[5]+e[13],i},transformMat3:function(n,e,r){const i=r??new t(2),o=n[0],s=n[1];return i[0]=e[0]*o+e[4]*s+e[8],i[1]=e[1]*o+e[5]*s+e[9],i},rotate:function(n,e,r,i){const o=i??new t(2),s=n[0]-e[0],a=n[1]-e[1],c=Math.sin(r),u=Math.cos(r);return o[0]=s*u-a*c+e[0],o[1]=s*c+a*u+e[1],o},setLength:m,truncate:function(n,e,r){const i=r??new t(2);return c(n)>e?m(n,e,i):d(n,i)},midpoint:function(n,e,i){return r(n,e,.5,i??new t(2))}}}(t),a.set(t,n)),n}const u=new Map;function h(t){let n=u.get(t);return n||(n=function(t){function n(n,e,r){const i=new t(3);return void 0!==n&&(i[0]=n,void 0!==e&&(i[1]=e,void 0!==r&&(i[2]=r))),i}function e(n,e,r){const i=r??new t(3);return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],i}function r(n,e,r,i){const o=i??new t(3);return o[0]=n[0]+r*(e[0]-n[0]),o[1]=n[1]+r*(e[1]-n[1]),o[2]=n[2]+r*(e[2]-n[2]),o}function i(n,e,r){const i=r??new t(3);return i[0]=n[0]*e,i[1]=n[1]*e,i[2]=n[2]*e,i}function o(n,e){const r=e??new t(3);return r[0]=1/n[0],r[1]=1/n[1],r[2]=1/n[2],r}function a(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function c(t){const n=t[0],e=t[1],r=t[2];return Math.sqrt(n*n+e*e+r*r)}function u(t){const n=t[0],e=t[1],r=t[2];return n*n+e*e+r*r}function h(t,n){const e=t[0]-n[0],r=t[1]-n[1],i=t[2]-n[2];return Math.sqrt(e*e+r*r+i*i)}function f(t,n){const e=t[0]-n[0],r=t[1]-n[1],i=t[2]-n[2];return e*e+r*r+i*i}function l(n,e){const r=e??new t(3),i=n[0],o=n[1],s=n[2],a=Math.sqrt(i*i+o*o+s*s);return a>1e-5?(r[0]=i/a,r[1]=o/a,r[2]=s/a):(r[0]=0,r[1]=0,r[2]=0),r}function d(n,e){const r=e??new t(3);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r}function M(n,e,r){const i=r??new t(3);return i[0]=n[0]*e[0],i[1]=n[1]*e[1],i[2]=n[2]*e[2],i}function w(n,e,r){const i=r??new t(3);return i[0]=n[0]/e[0],i[1]=n[1]/e[1],i[2]=n[2]/e[2],i}function m(n,e,r){const o=r??new t(3);return l(n,o),i(o,e,o)}return{create:n,fromValues:n,set:function(n,e,r,i){const o=i??new t(3);return o[0]=n,o[1]=e,o[2]=r,o},ceil:function(n,e){const r=e??new t(3);return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r[2]=Math.ceil(n[2]),r},floor:function(n,e){const r=e??new t(3);return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r[2]=Math.floor(n[2]),r},round:function(n,e){const r=e??new t(3);return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r[2]=Math.round(n[2]),r},clamp:function(n,e=0,r=1,i){const o=i??new t(3);return o[0]=Math.min(r,Math.max(e,n[0])),o[1]=Math.min(r,Math.max(e,n[1])),o[2]=Math.min(r,Math.max(e,n[2])),o},add:function(n,e,r){const i=r??new t(3);return i[0]=n[0]+e[0],i[1]=n[1]+e[1],i[2]=n[2]+e[2],i},addScaled:function(n,e,r,i){const o=i??new t(3);return o[0]=n[0]+e[0]*r,o[1]=n[1]+e[1]*r,o[2]=n[2]+e[2]*r,o},angle:function(t,n){const e=t[0],r=t[1],i=t[2],o=n[0],s=n[1],c=n[2],u=Math.sqrt(e*e+r*r+i*i)*Math.sqrt(o*o+s*s+c*c),h=u&&a(t,n)/u;return Math.acos(h)},subtract:e,sub:e,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s&&Math.abs(t[2]-n[2])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]},lerp:r,lerpV:function(n,e,r,i){const o=i??new t(3);return o[0]=n[0]+r[0]*(e[0]-n[0]),o[1]=n[1]+r[1]*(e[1]-n[1]),o[2]=n[2]+r[2]*(e[2]-n[2]),o},max:function(n,e,r){const i=r??new t(3);return i[0]=Math.max(n[0],e[0]),i[1]=Math.max(n[1],e[1]),i[2]=Math.max(n[2],e[2]),i},min:function(n,e,r){const i=r??new t(3);return i[0]=Math.min(n[0],e[0]),i[1]=Math.min(n[1],e[1]),i[2]=Math.min(n[2],e[2]),i},mulScalar:i,scale:i,divScalar:function(n,e,r){const i=r??new t(3);return i[0]=n[0]/e,i[1]=n[1]/e,i[2]=n[2]/e,i},inverse:o,invert:o,cross:function(n,e,r){const i=r??new t(3),o=n[2]*e[0]-n[0]*e[2],s=n[0]*e[1]-n[1]*e[0];return i[0]=n[1]*e[2]-n[2]*e[1],i[1]=o,i[2]=s,i},dot:a,length:c,len:c,lengthSq:u,lenSq:u,distance:h,dist:h,distanceSq:f,distSq:f,normalize:l,negate:function(n,e){const r=e??new t(3);return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r},copy:d,clone:d,multiply:M,mul:M,divide:w,div:w,random:function(n=1,e){const r=e??new t(3),i=2*Math.random()*Math.PI,o=2*Math.random()-1,s=Math.sqrt(1-o*o)*n;return r[0]=Math.cos(i)*s,r[1]=Math.sin(i)*s,r[2]=o*n,r},zero:function(n){const e=n??new t(3);return e[0]=0,e[1]=0,e[2]=0,e},transformMat4:function(n,e,r){const i=r??new t(3),o=n[0],s=n[1],a=n[2],c=e[3]*o+e[7]*s+e[11]*a+e[15]||1;return i[0]=(e[0]*o+e[4]*s+e[8]*a+e[12])/c,i[1]=(e[1]*o+e[5]*s+e[9]*a+e[13])/c,i[2]=(e[2]*o+e[6]*s+e[10]*a+e[14])/c,i},transformMat4Upper3x3:function(n,e,r){const i=r??new t(3),o=n[0],s=n[1],a=n[2];return i[0]=o*e[0]+s*e[4]+a*e[8],i[1]=o*e[1]+s*e[5]+a*e[9],i[2]=o*e[2]+s*e[6]+a*e[10],i},transformMat3:function(n,e,r){const i=r??new t(3),o=n[0],s=n[1],a=n[2];return i[0]=o*e[0]+s*e[4]+a*e[8],i[1]=o*e[1]+s*e[5]+a*e[9],i[2]=o*e[2]+s*e[6]+a*e[10],i},transformQuat:function(n,e,r){const i=r??new t(3),o=e[0],s=e[1],a=e[2],c=2*e[3],u=n[0],h=n[1],f=n[2],l=s*f-a*h,d=a*u-o*f,M=o*h-s*u;return i[0]=u+l*c+2*(s*M-a*d),i[1]=h+d*c+2*(a*l-o*M),i[2]=f+M*c+2*(o*d-s*l),i},getTranslation:function(n,e){const r=e??new t(3);return r[0]=n[12],r[1]=n[13],r[2]=n[14],r},getAxis:function(n,e,r){const i=r??new t(3),o=4*e;return i[0]=n[o+0],i[1]=n[o+1],i[2]=n[o+2],i},getScaling:function(n,e){const r=e??new t(3),i=n[0],o=n[1],s=n[2],a=n[4],c=n[5],u=n[6],h=n[8],f=n[9],l=n[10];return r[0]=Math.sqrt(i*i+o*o+s*s),r[1]=Math.sqrt(a*a+c*c+u*u),r[2]=Math.sqrt(h*h+f*f+l*l),r},rotateX:function(n,e,r,i){const o=i??new t(3),s=[],a=[];return s[0]=n[0]-e[0],s[1]=n[1]-e[1],s[2]=n[2]-e[2],a[0]=s[0],a[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),a[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),o[0]=a[0]+e[0],o[1]=a[1]+e[1],o[2]=a[2]+e[2],o},rotateY:function(n,e,r,i){const o=i??new t(3),s=[],a=[];return s[0]=n[0]-e[0],s[1]=n[1]-e[1],s[2]=n[2]-e[2],a[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),a[1]=s[1],a[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),o[0]=a[0]+e[0],o[1]=a[1]+e[1],o[2]=a[2]+e[2],o},rotateZ:function(n,e,r,i){const o=i??new t(3),s=[],a=[];return s[0]=n[0]-e[0],s[1]=n[1]-e[1],s[2]=n[2]-e[2],a[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),a[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),a[2]=s[2],o[0]=a[0]+e[0],o[1]=a[1]+e[1],o[2]=a[2]+e[2],o},setLength:m,truncate:function(n,e,r){const i=r??new t(3);return c(n)>e?m(n,e,i):d(n,i)},midpoint:function(n,e,i){return r(n,e,.5,i??new t(3))}}}(t),u.set(t,n)),n}const f=new Map;function l(t){let n=f.get(t);return n||(n=function(t){const n=c(t),e=h(t);function r(n,e){const r=e??new t(12);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[8]=n[8],r[9]=n[9],r[10]=n[10],r}function i(n){const e=n??new t(12);return e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=1,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function o(n,e){const r=e??new t(12),i=n[0],o=n[1],s=n[2],a=n[4],c=n[5],u=n[6],h=n[8],f=n[9],l=n[10],d=l*c-u*f,M=-l*a+u*h,w=f*a-c*h,m=1/(i*d+o*M+s*w);return r[0]=d*m,r[1]=(-l*o+s*f)*m,r[2]=(u*o-s*c)*m,r[4]=M*m,r[5]=(l*i-s*h)*m,r[6]=(-u*i+s*a)*m,r[8]=w*m,r[9]=(-f*i+o*h)*m,r[10]=(c*i-o*a)*m,r}function a(n,e,r){const i=r??new t(12),o=n[0],s=n[1],a=n[2],c=n[4],u=n[5],h=n[6],f=n[8],l=n[9],d=n[10],M=e[0],w=e[1],m=e[2],p=e[4],v=e[5],g=e[6],x=e[8],b=e[9],y=e[10];return i[0]=o*M+c*w+f*m,i[1]=s*M+u*w+l*m,i[2]=a*M+h*w+d*m,i[4]=o*p+c*v+f*g,i[5]=s*p+u*v+l*g,i[6]=a*p+h*v+d*g,i[8]=o*x+c*b+f*y,i[9]=s*x+u*b+l*y,i[10]=a*x+h*b+d*y,i}return{clone:r,create:function(n,e,r,i,o,s,a,c,u){const h=new t(12);return h[3]=0,h[7]=0,h[11]=0,void 0!==n&&(h[0]=n,void 0!==e&&(h[1]=e,void 0!==r&&(h[2]=r,void 0!==i&&(h[4]=i,void 0!==o&&(h[5]=o,void 0!==s&&(h[6]=s,void 0!==a&&(h[8]=a,void 0!==c&&(h[9]=c,void 0!==u&&(h[10]=u))))))))),h},set:function(n,e,r,i,o,s,a,c,u,h){const f=h??new t(12);return f[0]=n,f[1]=e,f[2]=r,f[3]=0,f[4]=i,f[5]=o,f[6]=s,f[7]=0,f[8]=a,f[9]=c,f[10]=u,f[11]=0,f},fromMat4:function(n,e){const r=e??new t(12);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=0,r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=0,r},fromQuat:function(n,e){const r=e??new t(12),i=n[0],o=n[1],s=n[2],a=n[3],c=i+i,u=o+o,h=s+s,f=i*c,l=o*c,d=o*u,M=s*c,w=s*u,m=s*h,p=a*c,v=a*u,g=a*h;return r[0]=1-d-m,r[1]=l+g,r[2]=M-v,r[3]=0,r[4]=l-g,r[5]=1-f-m,r[6]=w+p,r[7]=0,r[8]=M+v,r[9]=w-p,r[10]=1-f-d,r[11]=0,r},negate:function(n,e){const r=e??new t(12);return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[4]=-n[4],r[5]=-n[5],r[6]=-n[6],r[8]=-n[8],r[9]=-n[9],r[10]=-n[10],r},copy:r,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s&&Math.abs(t[2]-n[2])<s&&Math.abs(t[4]-n[4])<s&&Math.abs(t[5]-n[5])<s&&Math.abs(t[6]-n[6])<s&&Math.abs(t[8]-n[8])<s&&Math.abs(t[9]-n[9])<s&&Math.abs(t[10]-n[10])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]},identity:i,transpose:function(n,e){const r=e??new t(12);if(r===n){let t;return t=n[1],n[1]=n[4],n[4]=t,t=n[2],n[2]=n[8],n[8]=t,t=n[6],n[6]=n[9],n[9]=t,r}const i=n[0],o=n[1],s=n[2],a=n[4],c=n[5],u=n[6],h=n[8],f=n[9],l=n[10];return r[0]=i,r[1]=a,r[2]=h,r[4]=o,r[5]=c,r[6]=f,r[8]=s,r[9]=u,r[10]=l,r},inverse:o,invert:o,determinant:function(t){const n=t[0],e=t[1],r=t[2],i=t[4],o=t[5],s=t[6],a=t[8],c=t[9],u=t[10];return n*(o*u-c*s)-i*(e*u-c*r)+a*(e*s-o*r)},mul:a,multiply:a,setTranslation:function(t,n,e){const r=e??i();return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[4]=t[4],r[5]=t[5],r[6]=t[6]),r[8]=n[0],r[9]=n[1],r[10]=1,r},getTranslation:function(t,e){const r=e??n.create();return r[0]=t[8],r[1]=t[9],r},getAxis:function(t,e,r){const i=r??n.create(),o=4*e;return i[0]=t[o+0],i[1]=t[o+1],i},setAxis:function(t,n,e,i){const o=i===t?t:r(t,i),s=4*e;return o[s+0]=n[0],o[s+1]=n[1],o},getScaling:function(t,e){const r=e??n.create(),i=t[0],o=t[1],s=t[4],a=t[5];return r[0]=Math.sqrt(i*i+o*o),r[1]=Math.sqrt(s*s+a*a),r},get3DScaling:function(t,n){const r=n??e.create(),i=t[0],o=t[1],s=t[2],a=t[4],c=t[5],u=t[6],h=t[8],f=t[9],l=t[10];return r[0]=Math.sqrt(i*i+o*o+s*s),r[1]=Math.sqrt(a*a+c*c+u*u),r[2]=Math.sqrt(h*h+f*f+l*l),r},translation:function(n,e){const r=e??new t(12);return r[0]=1,r[1]=0,r[2]=0,r[4]=0,r[5]=1,r[6]=0,r[8]=n[0],r[9]=n[1],r[10]=1,r},translate:function(n,e,r){const i=r??new t(12),o=e[0],s=e[1],a=n[0],c=n[1],u=n[2],h=n[4],f=n[5],l=n[6],d=n[8],M=n[9],w=n[10];return n!==i&&(i[0]=a,i[1]=c,i[2]=u,i[4]=h,i[5]=f,i[6]=l),i[8]=a*o+h*s+d,i[9]=c*o+f*s+M,i[10]=u*o+l*s+w,i},rotation:function(n,e){const r=e??new t(12),i=Math.cos(n),o=Math.sin(n);return r[0]=i,r[1]=o,r[2]=0,r[4]=-o,r[5]=i,r[6]=0,r[8]=0,r[9]=0,r[10]=1,r},rotate:function(n,e,r){const i=r??new t(12),o=n[0],s=n[1],a=n[2],c=n[4],u=n[5],h=n[6],f=Math.cos(e),l=Math.sin(e);return i[0]=f*o+l*c,i[1]=f*s+l*u,i[2]=f*a+l*h,i[4]=f*c-l*o,i[5]=f*u-l*s,i[6]=f*h-l*a,n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10]),i},scaling:function(n,e){const r=e??new t(12);return r[0]=n[0],r[1]=0,r[2]=0,r[4]=0,r[5]=n[1],r[6]=0,r[8]=0,r[9]=0,r[10]=1,r},scale:function(n,e,r){const i=r??new t(12),o=e[0],s=e[1];return i[0]=o*n[0],i[1]=o*n[1],i[2]=o*n[2],i[4]=s*n[4],i[5]=s*n[5],i[6]=s*n[6],n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10]),i},uniformScaling:function(n,e){const r=e??new t(12);return r[0]=n,r[1]=0,r[2]=0,r[4]=0,r[5]=n,r[6]=0,r[8]=0,r[9]=0,r[10]=1,r},uniformScale:function(n,e,r){const i=r??new t(12);return i[0]=e*n[0],i[1]=e*n[1],i[2]=e*n[2],i[4]=e*n[4],i[5]=e*n[5],i[6]=e*n[6],n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10]),i}}}(t),f.set(t,n)),n}const d=new Map;function M(t){let n=d.get(t);return n||(n=function(t){const n=h(t);function e(n,e){const r=e??new t(16);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r}const r=e;function i(n){const e=n??new t(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function o(n,e){const r=e??new t(16),i=n[0],o=n[1],s=n[2],a=n[3],c=n[4],u=n[5],h=n[6],f=n[7],l=n[8],d=n[9],M=n[10],w=n[11],m=n[12],p=n[13],v=n[14],g=n[15],x=M*g,b=v*w,y=h*g,A=v*f,q=h*w,P=M*f,B=s*g,U=v*a,S=s*w,z=M*a,F=s*f,G=h*a,T=l*p,C=m*d,R=c*p,V=m*u,j=c*d,D=l*u,O=i*p,L=m*o,E=i*d,I=l*o,k=i*u,X=c*o,_=x*u+A*d+q*p-(b*u+y*d+P*p),Y=b*o+B*d+z*p-(x*o+U*d+S*p),W=y*o+U*u+F*p-(A*o+B*u+G*p),N=P*o+S*u+G*d-(q*o+z*u+F*d),Z=1/(i*_+c*Y+l*W+m*N);return r[0]=Z*_,r[1]=Z*Y,r[2]=Z*W,r[3]=Z*N,r[4]=Z*(b*c+y*l+P*m-(x*c+A*l+q*m)),r[5]=Z*(x*i+U*l+S*m-(b*i+B*l+z*m)),r[6]=Z*(A*i+B*c+G*m-(y*i+U*c+F*m)),r[7]=Z*(q*i+z*c+F*l-(P*i+S*c+G*l)),r[8]=Z*(T*f+V*w+j*g-(C*f+R*w+D*g)),r[9]=Z*(C*a+O*w+I*g-(T*a+L*w+E*g)),r[10]=Z*(R*a+L*f+k*g-(V*a+O*f+X*g)),r[11]=Z*(D*a+E*f+X*w-(j*a+I*f+k*w)),r[12]=Z*(R*M+D*v+C*h-(j*v+T*h+V*M)),r[13]=Z*(E*v+T*s+L*M-(O*M+I*v+C*s)),r[14]=Z*(O*h+X*v+V*s-(k*v+R*s+L*h)),r[15]=Z*(k*M+j*s+I*h-(E*h+X*M+D*s)),r}const a=o;function c(n,e,r){const i=r??new t(16),o=n[0],s=n[1],a=n[2],c=n[3],u=n[4],h=n[5],f=n[6],l=n[7],d=n[8],M=n[9],w=n[10],m=n[11],p=n[12],v=n[13],g=n[14],x=n[15],b=e[0],y=e[1],A=e[2],q=e[3],P=e[4],B=e[5],U=e[6],S=e[7],z=e[8],F=e[9],G=e[10],T=e[11],C=e[12],R=e[13],V=e[14],j=e[15];return i[0]=o*b+u*y+d*A+p*q,i[1]=s*b+h*y+M*A+v*q,i[2]=a*b+f*y+w*A+g*q,i[3]=c*b+l*y+m*A+x*q,i[4]=o*P+u*B+d*U+p*S,i[5]=s*P+h*B+M*U+v*S,i[6]=a*P+f*B+w*U+g*S,i[7]=c*P+l*B+m*U+x*S,i[8]=o*z+u*F+d*G+p*T,i[9]=s*z+h*F+M*G+v*T,i[10]=a*z+f*F+w*G+g*T,i[11]=c*z+l*F+m*G+x*T,i[12]=o*C+u*R+d*V+p*j,i[13]=s*C+h*R+M*V+v*j,i[14]=a*C+f*R+w*V+g*j,i[15]=c*C+l*R+m*V+x*j,i}const u=c,f=n.create(),l=n.create(),d=n.create();function M(n,e,r){const i=r??new t(16);let o=n[0],s=n[1],a=n[2];const c=Math.sqrt(o*o+s*s+a*a);o/=c,s/=c,a/=c;const u=o*o,h=s*s,f=a*a,l=Math.cos(e),d=Math.sin(e),M=1-l;return i[0]=u+(1-u)*l,i[1]=o*s*M+a*d,i[2]=o*a*M-s*d,i[3]=0,i[4]=o*s*M-a*d,i[5]=h+(1-h)*l,i[6]=s*a*M+o*d,i[7]=0,i[8]=o*a*M+s*d,i[9]=s*a*M-o*d,i[10]=f+(1-f)*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function w(n,e,r,i){const o=i??new t(16);let s=e[0],a=e[1],c=e[2];const u=Math.sqrt(s*s+a*a+c*c);s/=u,a/=u,c/=u;const h=s*s,f=a*a,l=c*c,d=Math.cos(r),M=Math.sin(r),w=1-d,m=h+(1-h)*d,p=s*a*w+c*M,v=s*c*w-a*M,g=s*a*w-c*M,x=f+(1-f)*d,b=a*c*w+s*M,y=s*c*w+a*M,A=a*c*w-s*M,q=l+(1-l)*d,P=n[0],B=n[1],U=n[2],S=n[3],z=n[4],F=n[5],G=n[6],T=n[7],C=n[8],R=n[9],V=n[10],j=n[11];return o[0]=m*P+p*z+v*C,o[1]=m*B+p*F+v*R,o[2]=m*U+p*G+v*V,o[3]=m*S+p*T+v*j,o[4]=g*P+x*z+b*C,o[5]=g*B+x*F+b*R,o[6]=g*U+x*G+b*V,o[7]=g*S+x*T+b*j,o[8]=y*P+A*z+q*C,o[9]=y*B+A*F+q*R,o[10]=y*U+A*G+q*V,o[11]=y*S+A*T+q*j,n!==o&&(o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o}return{create:function(n,e,r,i,o,s,a,c,u,h,f,l,d,M,w,m){const p=new t(16);return void 0!==n&&(p[0]=n,void 0!==e&&(p[1]=e,void 0!==r&&(p[2]=r,void 0!==i&&(p[3]=i,void 0!==o&&(p[4]=o,void 0!==s&&(p[5]=s,void 0!==a&&(p[6]=a,void 0!==c&&(p[7]=c,void 0!==u&&(p[8]=u,void 0!==h&&(p[9]=h,void 0!==f&&(p[10]=f,void 0!==l&&(p[11]=l,void 0!==d&&(p[12]=d,void 0!==M&&(p[13]=M,void 0!==w&&(p[14]=w,void 0!==m&&(p[15]=m)))))))))))))))),p},set:function(n,e,r,i,o,s,a,c,u,h,f,l,d,M,w,m,p){const v=p??new t(16);return v[0]=n,v[1]=e,v[2]=r,v[3]=i,v[4]=o,v[5]=s,v[6]=a,v[7]=c,v[8]=u,v[9]=h,v[10]=f,v[11]=l,v[12]=d,v[13]=M,v[14]=w,v[15]=m,v},fromMat3:function(n,e){const r=e??new t(16);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=0,r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},fromQuat:function(n,e){const r=e??new t(16),i=n[0],o=n[1],s=n[2],a=n[3],c=i+i,u=o+o,h=s+s,f=i*c,l=o*c,d=o*u,M=s*c,w=s*u,m=s*h,p=a*c,v=a*u,g=a*h;return r[0]=1-d-m,r[1]=l+g,r[2]=M-v,r[3]=0,r[4]=l-g,r[5]=1-f-m,r[6]=w+p,r[7]=0,r[8]=M+v,r[9]=w-p,r[10]=1-f-d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},negate:function(n,e){const r=e??new t(16);return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=-n[3],r[4]=-n[4],r[5]=-n[5],r[6]=-n[6],r[7]=-n[7],r[8]=-n[8],r[9]=-n[9],r[10]=-n[10],r[11]=-n[11],r[12]=-n[12],r[13]=-n[13],r[14]=-n[14],r[15]=-n[15],r},copy:e,clone:r,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s&&Math.abs(t[2]-n[2])<s&&Math.abs(t[3]-n[3])<s&&Math.abs(t[4]-n[4])<s&&Math.abs(t[5]-n[5])<s&&Math.abs(t[6]-n[6])<s&&Math.abs(t[7]-n[7])<s&&Math.abs(t[8]-n[8])<s&&Math.abs(t[9]-n[9])<s&&Math.abs(t[10]-n[10])<s&&Math.abs(t[11]-n[11])<s&&Math.abs(t[12]-n[12])<s&&Math.abs(t[13]-n[13])<s&&Math.abs(t[14]-n[14])<s&&Math.abs(t[15]-n[15])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]},identity:i,transpose:function(n,e){const r=e??new t(16);if(r===n){let t;return t=n[1],n[1]=n[4],n[4]=t,t=n[2],n[2]=n[8],n[8]=t,t=n[3],n[3]=n[12],n[12]=t,t=n[6],n[6]=n[9],n[9]=t,t=n[7],n[7]=n[13],n[13]=t,t=n[11],n[11]=n[14],n[14]=t,r}const i=n[0],o=n[1],s=n[2],a=n[3],c=n[4],u=n[5],h=n[6],f=n[7],l=n[8],d=n[9],M=n[10],w=n[11],m=n[12],p=n[13],v=n[14],g=n[15];return r[0]=i,r[1]=c,r[2]=l,r[3]=m,r[4]=o,r[5]=u,r[6]=d,r[7]=p,r[8]=s,r[9]=h,r[10]=M,r[11]=v,r[12]=a,r[13]=f,r[14]=w,r[15]=g,r},inverse:o,determinant:function(t){const n=t[0],e=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],c=t[7],u=t[8],h=t[9],f=t[10],l=t[11],d=t[12],M=t[13],w=t[14],m=t[15],p=f*m,v=w*l,g=a*m,x=w*c,b=a*l,y=f*c,A=r*m,q=w*i,P=r*l,B=f*i,U=r*c,S=a*i;return n*(p*s+x*h+b*M-(v*s+g*h+y*M))+o*(v*e+A*h+B*M-(p*e+q*h+P*M))+u*(g*e+q*s+U*M-(x*e+A*s+S*M))+d*(y*e+P*s+S*h-(b*e+B*s+U*h))},invert:a,multiply:c,mul:u,setTranslation:function(t,n,e){const r=e??i();return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11]),r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r},getTranslation:function(t,e){const r=e??n.create();return r[0]=t[12],r[1]=t[13],r[2]=t[14],r},getAxis:function(t,e,r){const i=r??n.create(),o=4*e;return i[0]=t[o+0],i[1]=t[o+1],i[2]=t[o+2],i},setAxis:function(t,n,r,i){const o=i===t?i:e(t,i),s=4*r;return o[s+0]=n[0],o[s+1]=n[1],o[s+2]=n[2],o},getScaling:function(t,e){const r=e??n.create(),i=t[0],o=t[1],s=t[2],a=t[4],c=t[5],u=t[6],h=t[8],f=t[9],l=t[10];return r[0]=Math.sqrt(i*i+o*o+s*s),r[1]=Math.sqrt(a*a+c*c+u*u),r[2]=Math.sqrt(h*h+f*f+l*l),r},perspective:function(n,e,r,i,o){const s=o??new t(16),a=Math.tan(.5*Math.PI-.5*n);if(s[0]=a/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,Number.isFinite(i)){const t=1/(r-i);s[10]=i*t,s[14]=i*r*t}else s[10]=-1,s[14]=-r;return s},perspectiveReverseZ:function(n,e,r,i=1/0,o){const s=o??new t(16),a=1/Math.tan(.5*n);if(s[0]=a/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,i===1/0)s[10]=0,s[14]=r;else{const t=1/(i-r);s[10]=r*t,s[14]=i*r*t}return s},ortho:function(n,e,r,i,o,s,a){const c=a??new t(16);return c[0]=2/(e-n),c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2/(i-r),c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1/(o-s),c[11]=0,c[12]=(e+n)/(n-e),c[13]=(i+r)/(r-i),c[14]=o/(o-s),c[15]=1,c},frustum:function(n,e,r,i,o,s,a){const c=a??new t(16),u=e-n,h=i-r,f=o-s;return c[0]=2*o/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2*o/h,c[6]=0,c[7]=0,c[8]=(n+e)/u,c[9]=(i+r)/h,c[10]=s/f,c[11]=-1,c[12]=0,c[13]=0,c[14]=o*s/f,c[15]=0,c},frustumReverseZ:function(n,e,r,i,o,s=1/0,a){const c=a??new t(16),u=e-n,h=i-r;if(c[0]=2*o/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2*o/h,c[6]=0,c[7]=0,c[8]=(n+e)/u,c[9]=(i+r)/h,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,s===1/0)c[10]=0,c[14]=o;else{const t=1/(s-o);c[10]=o*t,c[14]=s*o*t}return c},aim:function(e,r,i,o){const s=o??new t(16);return n.normalize(n.subtract(r,e,d),d),n.normalize(n.cross(i,d,f),f),n.normalize(n.cross(d,f,l),l),s[0]=f[0],s[1]=f[1],s[2]=f[2],s[3]=0,s[4]=l[0],s[5]=l[1],s[6]=l[2],s[7]=0,s[8]=d[0],s[9]=d[1],s[10]=d[2],s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s},cameraAim:function(e,r,i,o){const s=o??new t(16);return n.normalize(n.subtract(e,r,d),d),n.normalize(n.cross(i,d,f),f),n.normalize(n.cross(d,f,l),l),s[0]=f[0],s[1]=f[1],s[2]=f[2],s[3]=0,s[4]=l[0],s[5]=l[1],s[6]=l[2],s[7]=0,s[8]=d[0],s[9]=d[1],s[10]=d[2],s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s},lookAt:function(e,r,i,o){const s=o??new t(16);return n.normalize(n.subtract(e,r,d),d),n.normalize(n.cross(i,d,f),f),n.normalize(n.cross(d,f,l),l),s[0]=f[0],s[1]=l[0],s[2]=d[0],s[3]=0,s[4]=f[1],s[5]=l[1],s[6]=d[1],s[7]=0,s[8]=f[2],s[9]=l[2],s[10]=d[2],s[11]=0,s[12]=-(f[0]*e[0]+f[1]*e[1]+f[2]*e[2]),s[13]=-(l[0]*e[0]+l[1]*e[1]+l[2]*e[2]),s[14]=-(d[0]*e[0]+d[1]*e[1]+d[2]*e[2]),s[15]=1,s},translation:function(n,e){const r=e??new t(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r},translate:function(n,e,r){const i=r??new t(16),o=e[0],s=e[1],a=e[2],c=n[0],u=n[1],h=n[2],f=n[3],l=n[4],d=n[5],M=n[6],w=n[7],m=n[8],p=n[9],v=n[10],g=n[11],x=n[12],b=n[13],y=n[14],A=n[15];return n!==i&&(i[0]=c,i[1]=u,i[2]=h,i[3]=f,i[4]=l,i[5]=d,i[6]=M,i[7]=w,i[8]=m,i[9]=p,i[10]=v,i[11]=g),i[12]=c*o+l*s+m*a+x,i[13]=u*o+d*s+p*a+b,i[14]=h*o+M*s+v*a+y,i[15]=f*o+w*s+g*a+A,i},rotationX:function(n,e){const r=e??new t(16),i=Math.cos(n),o=Math.sin(n);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=o,r[7]=0,r[8]=0,r[9]=-o,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotateX:function(n,e,r){const i=r??new t(16),o=n[4],s=n[5],a=n[6],c=n[7],u=n[8],h=n[9],f=n[10],l=n[11],d=Math.cos(e),M=Math.sin(e);return i[4]=d*o+M*u,i[5]=d*s+M*h,i[6]=d*a+M*f,i[7]=d*c+M*l,i[8]=d*u-M*o,i[9]=d*h-M*s,i[10]=d*f-M*a,i[11]=d*l-M*c,n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i},rotationY:function(n,e){const r=e??new t(16),i=Math.cos(n),o=Math.sin(n);return r[0]=i,r[1]=0,r[2]=-o,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=o,r[9]=0,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotateY:function(n,e,r){const i=r??new t(16),o=n[0],s=n[1],a=n[2],c=n[3],u=n[8],h=n[9],f=n[10],l=n[11],d=Math.cos(e),M=Math.sin(e);return i[0]=d*o-M*u,i[1]=d*s-M*h,i[2]=d*a-M*f,i[3]=d*c-M*l,i[8]=d*u+M*o,i[9]=d*h+M*s,i[10]=d*f+M*a,i[11]=d*l+M*c,n!==i&&(i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i},rotationZ:function(n,e){const r=e??new t(16),i=Math.cos(n),o=Math.sin(n);return r[0]=i,r[1]=o,r[2]=0,r[3]=0,r[4]=-o,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotateZ:function(n,e,r){const i=r??new t(16),o=n[0],s=n[1],a=n[2],c=n[3],u=n[4],h=n[5],f=n[6],l=n[7],d=Math.cos(e),M=Math.sin(e);return i[0]=d*o+M*u,i[1]=d*s+M*h,i[2]=d*a+M*f,i[3]=d*c+M*l,i[4]=d*u-M*o,i[5]=d*h-M*s,i[6]=d*f-M*a,i[7]=d*l-M*c,n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i},axisRotation:M,rotation:M,axisRotate:w,rotate:w,scaling:function(n,e){const r=e??new t(16);return r[0]=n[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=n[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},scale:function(n,e,r){const i=r??new t(16),o=e[0],s=e[1],a=e[2];return i[0]=o*n[0],i[1]=o*n[1],i[2]=o*n[2],i[3]=o*n[3],i[4]=s*n[4],i[5]=s*n[5],i[6]=s*n[6],i[7]=s*n[7],i[8]=a*n[8],i[9]=a*n[9],i[10]=a*n[10],i[11]=a*n[11],n!==i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i},uniformScaling:function(n,e){const r=e??new t(16);return r[0]=n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},uniformScale:function(n,e,r){const i=r??new t(16);return i[0]=e*n[0],i[1]=e*n[1],i[2]=e*n[2],i[3]=e*n[3],i[4]=e*n[4],i[5]=e*n[5],i[6]=e*n[6],i[7]=e*n[7],i[8]=e*n[8],i[9]=e*n[9],i[10]=e*n[10],i[11]=e*n[11],n!==i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i}}}(t),d.set(t,n)),n}const w=new Map;function m(t){let n=w.get(t);return n||(n=function(t){const n=h(t);function e(n,e,r,i){const o=new t(4);return void 0!==n&&(o[0]=n,void 0!==e&&(o[1]=e,void 0!==r&&(o[2]=r,void 0!==i&&(o[3]=i)))),o}const r=e;function i(n,e,r){const i=r??new t(4),o=.5*e,s=Math.sin(o);return i[0]=s*n[0],i[1]=s*n[1],i[2]=s*n[2],i[3]=Math.cos(o),i}function o(n,e,r){const i=r??new t(4),o=n[0],s=n[1],a=n[2],c=n[3],u=e[0],h=e[1],f=e[2],l=e[3];return i[0]=o*l+c*u+s*f-a*h,i[1]=s*l+c*h+a*u-o*f,i[2]=a*l+c*f+o*h-s*u,i[3]=c*l-o*u-s*h-a*f,i}const a=o;function c(n,e,r,i){const o=i??new t(4),a=n[0],c=n[1],u=n[2],h=n[3];let f,l,d=e[0],M=e[1],w=e[2],m=e[3],p=a*d+c*M+u*w+h*m;if(p<0&&(p=-p,d=-d,M=-M,w=-w,m=-m),1-p>s){const t=Math.acos(p),n=Math.sin(t);f=Math.sin((1-r)*t)/n,l=Math.sin(r*t)/n}else f=1-r,l=r;return o[0]=f*a+l*d,o[1]=f*c+l*M,o[2]=f*u+l*w,o[3]=f*h+l*m,o}function u(n,e){const r=e??new t(4);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r}const f=u;function l(n,e,r){const i=r??new t(4);return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],i[3]=n[3]-e[3],i}const d=l;function M(n,e,r){const i=r??new t(4);return i[0]=n[0]*e,i[1]=n[1]*e,i[2]=n[2]*e,i[3]=n[3]*e,i}const w=M;function m(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function p(t){const n=t[0],e=t[1],r=t[2],i=t[3];return Math.sqrt(n*n+e*e+r*r+i*i)}const v=p;function g(t){const n=t[0],e=t[1],r=t[2],i=t[3];return n*n+e*e+r*r+i*i}const x=g;function b(n,e){const r=e??new t(4),i=n[0],o=n[1],s=n[2],a=n[3],c=Math.sqrt(i*i+o*o+s*s+a*a);return c>1e-5?(r[0]=i/c,r[1]=o/c,r[2]=s/c,r[3]=a/c):(r[0]=0,r[1]=0,r[2]=0,r[3]=1),r}const y=n.create(),A=n.create(),q=n.create(),P=new t(4),B=new t(4);return{create:e,fromValues:r,set:function(n,e,r,i,o){const s=o??new t(4);return s[0]=n,s[1]=e,s[2]=r,s[3]=i,s},fromAxisAngle:i,toAxisAngle:function(t,e){const r=e??n.create(3),i=2*Math.acos(t[3]),o=Math.sin(.5*i);return o>s?(r[0]=t[0]/o,r[1]=t[1]/o,r[2]=t[2]/o):(r[0]=1,r[1]=0,r[2]=0),{angle:i,axis:r}},angle:function(t,n){const e=m(t,n);return Math.acos(2*e*e-1)},multiply:o,mul:a,rotateX:function(n,e,r){const i=r??new t(4),o=.5*e,s=n[0],a=n[1],c=n[2],u=n[3],h=Math.sin(o),f=Math.cos(o);return i[0]=s*f+u*h,i[1]=a*f+c*h,i[2]=c*f-a*h,i[3]=u*f-s*h,i},rotateY:function(n,e,r){const i=r??new t(4),o=.5*e,s=n[0],a=n[1],c=n[2],u=n[3],h=Math.sin(o),f=Math.cos(o);return i[0]=s*f-c*h,i[1]=a*f+u*h,i[2]=c*f+s*h,i[3]=u*f-a*h,i},rotateZ:function(n,e,r){const i=r??new t(4),o=.5*e,s=n[0],a=n[1],c=n[2],u=n[3],h=Math.sin(o),f=Math.cos(o);return i[0]=s*f+a*h,i[1]=a*f-s*h,i[2]=c*f+u*h,i[3]=u*f-c*h,i},slerp:c,inverse:function(n,e){const r=e??new t(4),i=n[0],o=n[1],s=n[2],a=n[3],c=i*i+o*o+s*s+a*a,u=c?1/c:0;return r[0]=-i*u,r[1]=-o*u,r[2]=-s*u,r[3]=a*u,r},conjugate:function(n,e){const r=e??new t(4);return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=n[3],r},fromMat:function(n,e){const r=e??new t(4),i=n[0]+n[5]+n[10];if(i>0){const t=Math.sqrt(i+1);r[3]=.5*t;const e=.5/t;r[0]=(n[6]-n[9])*e,r[1]=(n[8]-n[2])*e,r[2]=(n[1]-n[4])*e}else{let t=0;n[5]>n[0]&&(t=1),n[10]>n[4*t+t]&&(t=2);const e=(t+1)%3,i=(t+2)%3,o=Math.sqrt(n[4*t+t]-n[4*e+e]-n[4*i+i]+1);r[t]=.5*o;const s=.5/o;r[3]=(n[4*e+i]-n[4*i+e])*s,r[e]=(n[4*e+t]+n[4*t+e])*s,r[i]=(n[4*i+t]+n[4*t+i])*s}return r},fromEuler:function(n,e,r,i,o){const s=o??new t(4),a=.5*n,c=.5*e,u=.5*r,h=Math.sin(a),f=Math.cos(a),l=Math.sin(c),d=Math.cos(c),M=Math.sin(u),w=Math.cos(u);switch(i){case"xyz":s[0]=h*d*w+f*l*M,s[1]=f*l*w-h*d*M,s[2]=f*d*M+h*l*w,s[3]=f*d*w-h*l*M;break;case"xzy":s[0]=h*d*w-f*l*M,s[1]=f*l*w-h*d*M,s[2]=f*d*M+h*l*w,s[3]=f*d*w+h*l*M;break;case"yxz":s[0]=h*d*w+f*l*M,s[1]=f*l*w-h*d*M,s[2]=f*d*M-h*l*w,s[3]=f*d*w+h*l*M;break;case"yzx":s[0]=h*d*w+f*l*M,s[1]=f*l*w+h*d*M,s[2]=f*d*M-h*l*w,s[3]=f*d*w-h*l*M;break;case"zxy":s[0]=h*d*w-f*l*M,s[1]=f*l*w+h*d*M,s[2]=f*d*M+h*l*w,s[3]=f*d*w-h*l*M;break;case"zyx":s[0]=h*d*w-f*l*M,s[1]=f*l*w+h*d*M,s[2]=f*d*M-h*l*w,s[3]=f*d*w+h*l*M;break;default:throw new Error(`Unknown rotation order: ${i}`)}return s},copy:u,clone:f,add:function(n,e,r){const i=r??new t(4);return i[0]=n[0]+e[0],i[1]=n[1]+e[1],i[2]=n[2]+e[2],i[3]=n[3]+e[3],i},subtract:l,sub:d,mulScalar:M,scale:w,divScalar:function(n,e,r){const i=r??new t(4);return i[0]=n[0]/e,i[1]=n[1]/e,i[2]=n[2]/e,i[3]=n[3]/e,i},dot:m,lerp:function(n,e,r,i){const o=i??new t(4);return o[0]=n[0]+r*(e[0]-n[0]),o[1]=n[1]+r*(e[1]-n[1]),o[2]=n[2]+r*(e[2]-n[2]),o[3]=n[3]+r*(e[3]-n[3]),o},length:p,len:v,lengthSq:g,lenSq:x,normalize:b,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s&&Math.abs(t[2]-n[2])<s&&Math.abs(t[3]-n[3])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},identity:function(n){const e=n??new t(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},rotationTo:function(e,r,o){const s=o??new t(4),a=n.dot(e,r);return a<-.999999?(n.cross(A,e,y),n.len(y)<1e-6&&n.cross(q,e,y),n.normalize(y,y),i(y,Math.PI,s),s):a>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(n.cross(e,r,y),s[0]=y[0],s[1]=y[1],s[2]=y[2],s[3]=1+a,b(s,s))},sqlerp:function(n,e,r,i,o,s){const a=s??new t(4);return c(n,i,o,P),c(e,r,o,B),c(P,B,2*o*(1-o),a),a}}}(t),w.set(t,n)),n}const p=new Map;function v(t){let n=p.get(t);return n||(n=function(t){function n(n,e,r,i){const o=new t(4);return void 0!==n&&(o[0]=n,void 0!==e&&(o[1]=e,void 0!==r&&(o[2]=r,void 0!==i&&(o[3]=i)))),o}function e(n,e,r){const i=r??new t(4);return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],i[3]=n[3]-e[3],i}function r(n,e,r,i){const o=i??new t(4);return o[0]=n[0]+r*(e[0]-n[0]),o[1]=n[1]+r*(e[1]-n[1]),o[2]=n[2]+r*(e[2]-n[2]),o[3]=n[3]+r*(e[3]-n[3]),o}function i(n,e,r){const i=r??new t(4);return i[0]=n[0]*e,i[1]=n[1]*e,i[2]=n[2]*e,i[3]=n[3]*e,i}function o(n,e){const r=e??new t(4);return r[0]=1/n[0],r[1]=1/n[1],r[2]=1/n[2],r[3]=1/n[3],r}function a(t){const n=t[0],e=t[1],r=t[2],i=t[3];return Math.sqrt(n*n+e*e+r*r+i*i)}function c(t){const n=t[0],e=t[1],r=t[2],i=t[3];return n*n+e*e+r*r+i*i}function u(t,n){const e=t[0]-n[0],r=t[1]-n[1],i=t[2]-n[2],o=t[3]-n[3];return Math.sqrt(e*e+r*r+i*i+o*o)}function h(t,n){const e=t[0]-n[0],r=t[1]-n[1],i=t[2]-n[2],o=t[3]-n[3];return e*e+r*r+i*i+o*o}function f(n,e){const r=e??new t(4),i=n[0],o=n[1],s=n[2],a=n[3],c=Math.sqrt(i*i+o*o+s*s+a*a);return c>1e-5?(r[0]=i/c,r[1]=o/c,r[2]=s/c,r[3]=a/c):(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function l(n,e){const r=e??new t(4);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r}function d(n,e,r){const i=r??new t(4);return i[0]=n[0]*e[0],i[1]=n[1]*e[1],i[2]=n[2]*e[2],i[3]=n[3]*e[3],i}function M(n,e,r){const i=r??new t(4);return i[0]=n[0]/e[0],i[1]=n[1]/e[1],i[2]=n[2]/e[2],i[3]=n[3]/e[3],i}function w(n,e,r){const o=r??new t(4);return f(n,o),i(o,e,o)}return{create:n,fromValues:n,set:function(n,e,r,i,o){const s=o??new t(4);return s[0]=n,s[1]=e,s[2]=r,s[3]=i,s},ceil:function(n,e){const r=e??new t(4);return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r[2]=Math.ceil(n[2]),r[3]=Math.ceil(n[3]),r},floor:function(n,e){const r=e??new t(4);return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r[2]=Math.floor(n[2]),r[3]=Math.floor(n[3]),r},round:function(n,e){const r=e??new t(4);return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r[2]=Math.round(n[2]),r[3]=Math.round(n[3]),r},clamp:function(n,e=0,r=1,i){const o=i??new t(4);return o[0]=Math.min(r,Math.max(e,n[0])),o[1]=Math.min(r,Math.max(e,n[1])),o[2]=Math.min(r,Math.max(e,n[2])),o[3]=Math.min(r,Math.max(e,n[3])),o},add:function(n,e,r){const i=r??new t(4);return i[0]=n[0]+e[0],i[1]=n[1]+e[1],i[2]=n[2]+e[2],i[3]=n[3]+e[3],i},addScaled:function(n,e,r,i){const o=i??new t(4);return o[0]=n[0]+e[0]*r,o[1]=n[1]+e[1]*r,o[2]=n[2]+e[2]*r,o[3]=n[3]+e[3]*r,o},subtract:e,sub:e,equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s&&Math.abs(t[2]-n[2])<s&&Math.abs(t[3]-n[3])<s},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},lerp:r,lerpV:function(n,e,r,i){const o=i??new t(4);return o[0]=n[0]+r[0]*(e[0]-n[0]),o[1]=n[1]+r[1]*(e[1]-n[1]),o[2]=n[2]+r[2]*(e[2]-n[2]),o[3]=n[3]+r[3]*(e[3]-n[3]),o},max:function(n,e,r){const i=r??new t(4);return i[0]=Math.max(n[0],e[0]),i[1]=Math.max(n[1],e[1]),i[2]=Math.max(n[2],e[2]),i[3]=Math.max(n[3],e[3]),i},min:function(n,e,r){const i=r??new t(4);return i[0]=Math.min(n[0],e[0]),i[1]=Math.min(n[1],e[1]),i[2]=Math.min(n[2],e[2]),i[3]=Math.min(n[3],e[3]),i},mulScalar:i,scale:i,divScalar:function(n,e,r){const i=r??new t(4);return i[0]=n[0]/e,i[1]=n[1]/e,i[2]=n[2]/e,i[3]=n[3]/e,i},inverse:o,invert:o,dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},length:a,len:a,lengthSq:c,lenSq:c,distance:u,dist:u,distanceSq:h,distSq:h,normalize:f,negate:function(n,e){const r=e??new t(4);return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=-n[3],r},copy:l,clone:l,multiply:d,mul:d,divide:M,div:M,zero:function(n){const e=n??new t(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},transformMat4:function(n,e,r){const i=r??new t(4),o=n[0],s=n[1],a=n[2],c=n[3];return i[0]=e[0]*o+e[4]*s+e[8]*a+e[12]*c,i[1]=e[1]*o+e[5]*s+e[9]*a+e[13]*c,i[2]=e[2]*o+e[6]*s+e[10]*a+e[14]*c,i[3]=e[3]*o+e[7]*s+e[11]*a+e[15]*c,i},setLength:w,truncate:function(n,e,r){const i=r??new t(4);return a(n)>e?w(n,e,i):l(n,i)},midpoint:function(n,e,i){return r(n,e,.5,i??new t(4))}}}(t),p.set(t,n)),n}function g(t,n,e,r,i,o){return{mat3:l(t),mat4:M(n),quat:m(e),vec2:c(r),vec3:h(i),vec4:v(o)}}const{mat3:x,mat4:b,quat:y,vec2:A,vec3:q,vec4:P}=g(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);g(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array),g(r,Array,Array,Array,Array,Array);class B{position;target;up;viewMatrix;projectionMatrix;fov;aspectRatio;near;far;orientation=y.create();distance;angularVelocity=.01;axis=q.create();constructor(t,n,e,r,i,o,s){this.position=new Float32Array(t),this.target=new Float32Array(n),this.up=new Float32Array(e),this.fov=r*Math.PI/180,this.aspectRatio=i,this.near=o,this.far=s,this.distance=q.length(q.subtract(new Float32Array(3),t,n)),this.viewMatrix=b.lookAt(this.position,this.target,this.up),this.projectionMatrix=b.perspective(this.fov,this.aspectRatio,this.near,this.far)}updateViewMatrix(){b.lookAt(this.position,this.target,this.up,this.viewMatrix)}setAspectRatio(t){this.aspectRatio=t,this.updateProjectionMatrix()}lookAt(t){this.target=new Float32Array(t),this.updateViewMatrix()}setPosition(t){this.position=new Float32Array(t),this.updateViewMatrix()}updateProjectionMatrix(){b.perspective(this.fov,this.aspectRatio,this.near,this.far,this.projectionMatrix)}move(t){q.add(this.position,t,this.position),this.updateViewMatrix()}}class U{camera;canvas;isMouseDown=!1;lastMouseX=null;lastMouseY=null;mouseDelta={x:0,y:0};constructor(t,n){this.camera=t,this.canvas=n,this.addKeyboardListeners(),this.addMouseListeners()}addKeyboardListeners(){window.addEventListener("keydown",this.handleKeyDown)}addMouseListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("mousemove",this.handleMouseMove)}handleMouseDown=t=>{this.isMouseDown=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY};handleMouseUp=()=>{this.isMouseDown=!1};handleMouseMove=t=>{if(!this.isMouseDown)return;const n=t.clientX-(this.lastMouseX||t.clientX),e=t.clientY-(this.lastMouseY||t.clientY);this.mouseDelta.x+=n,this.mouseDelta.y+=e,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,console.log(n,e)};updateCameraOrbit(t){let n=Math.sqrt(this.camera.position[0]**2+this.camera.position[1]**2+this.camera.position[2]**2),e=Math.atan2(this.camera.position[0],this.camera.position[2]),r=Math.acos(this.camera.position[1]/n);e-=this.mouseDelta.x*t*.5,r-=this.mouseDelta.y*t*.5,r=Math.max(.1,Math.min(Math.PI-.1,r)),this.camera.setPosition([n*Math.sin(r)*Math.sin(e),n*Math.cos(r),n*Math.sin(r)*Math.cos(e)]),this.mouseDelta.x=0,this.mouseDelta.y=0,this.camera.lookAt([0,0,0])}handleKeyDown=t=>{switch(t.key){case"ArrowUp":case"w":this.moveCamera([0,0,-.1]);break;case"ArrowDown":case"s":this.moveCamera([0,0,.1]);break;case"ArrowLeft":case"a":this.moveCamera([-.1,0,0]);break;case"ArrowRight":case"d":this.moveCamera([.1,0,0]);break;case"q":this.moveCamera([0,.1,0]);break;case"e":this.moveCamera([0,-.1,0])}t.preventDefault()};moveCamera(t){this.camera.move(t)}}class S{canvas;context;device;swapChainFormat="bgra8unorm";scene;camera;cameraControls;depthTexture;constructor(r){this.canvas=document.getElementById(r),this.initializeWebGPU().then((()=>{this.clearCanvas(),this.createDepthTexture(),this.camera=new B([2,2,-5],[0,0,0],[0,1,0],45,this.canvas.width/this.canvas.height,.1,100),this.resizeCanvas(),this.cameraControls=new U(this.camera,this.canvas),this.scene=new t(this.device);const r=new n(this.device,[1,0,0,1],[.5,.5,0]),i=new n(this.device,[1,0,1,1],[0,0,0]),o=new e(this.device,[0,-1,0,1],[0,0,0],.6);this.scene.addObject(r),this.scene.addObject(i),this.scene.addObject(o),this.startRenderingLoop()})).catch((t=>{console.error("Failed to initialize WebGPU:",t)}))}createDepthTexture(){this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture({size:{width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1},format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT})}async initializeWebGPU(){if(!navigator.gpu)throw new Error("WebGPU is not supported.");const t=await navigator.gpu.requestAdapter();if(!t)throw new Error("Failed to get GPU adapter.");this.device=await t.requestDevice(),this.context=this.canvas.getContext("webgpu");window.devicePixelRatio;this.canvas.clientWidth,this.canvas.clientHeight;const n={device:this.device,alphaMode:"premultiplied",format:this.swapChainFormat};this.context.configure(n)}resizeCanvas(){this.canvas.width=this.canvas.clientWidth*window.devicePixelRatio,this.canvas.height=this.canvas.clientHeight*window.devicePixelRatio,this.camera.setAspectRatio(this.canvas.width/this.canvas.height),this.camera.updateProjectionMatrix(),this.createDepthTexture()}clearCanvas(){const t=this.device.createCommandEncoder(),n={colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:0,g:0,b:0,a:1},storeOp:"store"}]};t.beginRenderPass(n).end();const e=t.finish();this.device.queue.submit([e])}startRenderingLoop(){const t=()=>{this.render(),requestAnimationFrame(t)};requestAnimationFrame(t)}render(){this.camera.updateViewMatrix(),this.camera.updateProjectionMatrix(),this.cameraControls.updateCameraOrbit(.01);const t=this.device.createCommandEncoder(),n={colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:0,g:0,b:0,a:1},storeOp:"store"}],depthStencilAttachment:{view:this.depthTexture.createView(),depthLoadOp:"clear",depthClearValue:1,depthStoreOp:"store"}},e=t.beginRenderPass(n);this.scene.draw(e,this.camera),e.end();const r=t.finish();this.device.queue.submit([r])}}(async function(){if(!navigator.gpu)return console.error("WebGPU is not supported on this device!"),!1;try{const t=await navigator.gpu.requestAdapter();if(!t)return console.error("Failed to get GPU adapter!"),!1;if(!await t.requestDevice())return console.error("Failed to get GPU device!"),!1}catch(t){return console.error("An error occurred while initializing WebGPU:",t),!1}return console.log("WebGPU is supported."),!0})().then((t=>{t?(console.log("Loading rendering engine..."),new S("gpuCanvas")):console.log("Rendering engine cannot be loaded due to lack of WebGPU support.")}))}();
//# sourceMappingURL=bundle.js.map
