!function(){"use strict";class t{device;objects;constructor(t){this.device=t,this.objects=[],console.log("Scene created.")}addObject(t){this.objects.push(t)}removeObject(t){const e=this.objects.indexOf(t);e>-1&&this.objects.splice(e,1)}getObjects(){return this.objects}draw(t,e){for(const n of this.objects)n.draw(t,e)}}class e{device;pipeline;vertexBuffer;color;position;uniformBuffer;bindGroup;constructor(t,e,n){this.device=t,this.color=new Float32Array(e),this.position=new Float32Array(n),this.initializeBuffers(),this.createPipeline()}initializeBuffers(){this.createVertexBuffer(),this.createUniformBuffer()}createVertexBuffer(){const t=new Float32Array([0+this.position[0],.5+this.position[1],this.position[2],1,-.5+this.position[0],-.5+this.position[1],this.position[2],1,.5+this.position[0],-.5+this.position[1],this.position[2],1]);this.vertexBuffer=this.device.createBuffer({size:t.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.vertexBuffer.getMappedRange()).set(t),this.vertexBuffer.unmap()}createUniformBuffer(){this.uniformBuffer=this.device.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}createPipeline(){const t=`\n        @fragment\n        fn fs_main() -> @location(0) vec4<f32> {\n            return vec4<f32>(${this.color.join(",")});\n        }`;this.pipeline=this.device.createRenderPipeline({label:"triangle-pipeline",layout:"auto",vertex:{module:this.device.createShaderModule({code:"\n        struct Uniforms {\n    viewMatrix: mat4x4<f32>,\n    projectionMatrix: mat4x4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: Uniforms;\n\n@vertex\nfn vs_main(@location(0) position: vec4<f32>) -> @builtin(position) vec4<f32> {\n    let worldPosition = position;\n    let viewPosition = uniforms.viewMatrix * worldPosition;\n    let clipPosition = uniforms.projectionMatrix * viewPosition;\n    return clipPosition;\n}"}),entryPoint:"vs_main",buffers:[{arrayStride:16,attributes:[{shaderLocation:0,offset:0,format:"float32x4"}]}]},fragment:{module:this.device.createShaderModule({code:t}),entryPoint:"fs_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}}),this.createBindGroup()}createBindGroup(){const t=this.pipeline.getBindGroupLayout(0);this.bindGroup=this.device.createBindGroup({layout:t,entries:[{binding:0,resource:{buffer:this.uniformBuffer,size:128}}]})}draw(t,e){this.device.queue.writeBuffer(this.uniformBuffer,0,e.viewMatrix.buffer,e.viewMatrix.byteOffset,e.viewMatrix.byteLength),this.device.queue.writeBuffer(this.uniformBuffer,64,e.projectionMatrix.buffer,e.projectionMatrix.byteOffset,e.projectionMatrix.byteLength),t.setPipeline(this.pipeline),t.setVertexBuffer(0,this.vertexBuffer),t.setBindGroup(0,this.bindGroup),t.draw(3,1,0,0)}}async function n(t,e){const n=new Image;n.src=e,await n.decode();const r=document.createElement("canvas");r.width=n.width,r.height=n.height;const i=r.getContext("2d");i.drawImage(n,0,0);const o=i.getImageData(0,0,n.width,n.height),s=t.createTexture({size:[n.width,n.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return t.queue.writeTexture({texture:s},o.data,{bytesPerRow:4*n.width,rowsPerImage:n.height},{width:n.width,height:n.height,depthOrArrayLayers:1}),s}function r(t){return t.createSampler({magFilter:"linear",minFilter:"linear",addressModeU:"repeat",addressModeV:"repeat"})}const i=(o=Array,s=t=>t.fill(0),class extends o{constructor(...t){super(...t),s(this)}});var o,s;let a=1e-6;const c=new Map;function u(t){let e=c.get(t);return e||(e=function(t){function e(e=0,n=0){const r=new t(2);return void 0!==e&&(r[0]=e,void 0!==n&&(r[1]=n)),r}function n(e,n,r){const i=r??new t(2);return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i}function r(e,n,r,i){const o=i??new t(2);return o[0]=e[0]+r*(n[0]-e[0]),o[1]=e[1]+r*(n[1]-e[1]),o}function i(e,n,r){const i=r??new t(2);return i[0]=e[0]*n,i[1]=e[1]*n,i}function o(e,n){const r=n??new t(2);return r[0]=1/e[0],r[1]=1/e[1],r}function s(t,e){return t[0]*e[0]+t[1]*e[1]}function c(t){const e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function u(t){const e=t[0],n=t[1];return e*e+n*n}function h(t,e){const n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function f(t,e){const n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function l(e,n){const r=n??new t(2),i=e[0],o=e[1],s=Math.sqrt(i*i+o*o);return s>1e-5?(r[0]=i/s,r[1]=o/s):(r[0]=0,r[1]=0),r}function d(e,n){const r=n??new t(2);return r[0]=e[0],r[1]=e[1],r}function m(e,n,r){const i=r??new t(2);return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i}function M(e,n,r){const i=r??new t(2);return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i}function p(e,n,r){const o=r??new t(2);return l(e,o),i(o,n,o)}return{create:e,fromValues:e,set:function(e,n,r){const i=r??new t(2);return i[0]=e,i[1]=n,i},ceil:function(e,n){const r=n??new t(2);return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r},floor:function(e,n){const r=n??new t(2);return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r},round:function(e,n){const r=n??new t(2);return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r},clamp:function(e,n=0,r=1,i){const o=i??new t(2);return o[0]=Math.min(r,Math.max(n,e[0])),o[1]=Math.min(r,Math.max(n,e[1])),o},add:function(e,n,r){const i=r??new t(2);return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i},addScaled:function(e,n,r,i){const o=i??new t(2);return o[0]=e[0]+n[0]*r,o[1]=e[1]+n[1]*r,o},angle:function(t,e){const n=t[0],r=t[1],i=e[0],o=e[1],a=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o),c=a&&s(t,e)/a;return Math.acos(c)},subtract:n,sub:n,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},lerp:r,lerpV:function(e,n,r,i){const o=i??new t(2);return o[0]=e[0]+r[0]*(n[0]-e[0]),o[1]=e[1]+r[1]*(n[1]-e[1]),o},max:function(e,n,r){const i=r??new t(2);return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i},min:function(e,n,r){const i=r??new t(2);return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i},mulScalar:i,scale:i,divScalar:function(e,n,r){const i=r??new t(2);return i[0]=e[0]/n,i[1]=e[1]/n,i},inverse:o,invert:o,cross:function(e,n,r){const i=r??new t(3),o=e[0]*n[1]-e[1]*n[0];return i[0]=0,i[1]=0,i[2]=o,i},dot:s,length:c,len:c,lengthSq:u,lenSq:u,distance:h,dist:h,distanceSq:f,distSq:f,normalize:l,negate:function(e,n){const r=n??new t(2);return r[0]=-e[0],r[1]=-e[1],r},copy:d,clone:d,multiply:m,mul:m,divide:M,div:M,random:function(e=1,n){const r=n??new t(2),i=2*Math.random()*Math.PI;return r[0]=Math.cos(i)*e,r[1]=Math.sin(i)*e,r},zero:function(e){const n=e??new t(2);return n[0]=0,n[1]=0,n},transformMat4:function(e,n,r){const i=r??new t(2),o=e[0],s=e[1];return i[0]=o*n[0]+s*n[4]+n[12],i[1]=o*n[1]+s*n[5]+n[13],i},transformMat3:function(e,n,r){const i=r??new t(2),o=e[0],s=e[1];return i[0]=n[0]*o+n[4]*s+n[8],i[1]=n[1]*o+n[5]*s+n[9],i},rotate:function(e,n,r,i){const o=i??new t(2),s=e[0]-n[0],a=e[1]-n[1],c=Math.sin(r),u=Math.cos(r);return o[0]=s*u-a*c+n[0],o[1]=s*c+a*u+n[1],o},setLength:p,truncate:function(e,n,r){const i=r??new t(2);return c(e)>n?p(e,n,i):d(e,i)},midpoint:function(e,n,i){return r(e,n,.5,i??new t(2))}}}(t),c.set(t,e)),e}const h=new Map;function f(t){let e=h.get(t);return e||(e=function(t){function e(e,n,r){const i=new t(3);return void 0!==e&&(i[0]=e,void 0!==n&&(i[1]=n,void 0!==r&&(i[2]=r))),i}function n(e,n,r){const i=r??new t(3);return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i}function r(e,n,r,i){const o=i??new t(3);return o[0]=e[0]+r*(n[0]-e[0]),o[1]=e[1]+r*(n[1]-e[1]),o[2]=e[2]+r*(n[2]-e[2]),o}function i(e,n,r){const i=r??new t(3);return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function o(e,n){const r=n??new t(3);return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r}function s(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function c(t){const e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function u(t){const e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function h(t,e){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function f(t,e){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function l(e,n){const r=n??new t(3),i=e[0],o=e[1],s=e[2],a=Math.sqrt(i*i+o*o+s*s);return a>1e-5?(r[0]=i/a,r[1]=o/a,r[2]=s/a):(r[0]=0,r[1]=0,r[2]=0),r}function d(e,n){const r=n??new t(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function m(e,n,r){const i=r??new t(3);return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i}function M(e,n,r){const i=r??new t(3);return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i}function p(e,n,r){const o=r??new t(3);return l(e,o),i(o,n,o)}return{create:e,fromValues:e,set:function(e,n,r,i){const o=i??new t(3);return o[0]=e,o[1]=n,o[2]=r,o},ceil:function(e,n){const r=n??new t(3);return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r},floor:function(e,n){const r=n??new t(3);return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r},round:function(e,n){const r=n??new t(3);return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r},clamp:function(e,n=0,r=1,i){const o=i??new t(3);return o[0]=Math.min(r,Math.max(n,e[0])),o[1]=Math.min(r,Math.max(n,e[1])),o[2]=Math.min(r,Math.max(n,e[2])),o},add:function(e,n,r){const i=r??new t(3);return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i},addScaled:function(e,n,r,i){const o=i??new t(3);return o[0]=e[0]+n[0]*r,o[1]=e[1]+n[1]*r,o[2]=e[2]+n[2]*r,o},angle:function(t,e){const n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],c=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+c*c),h=u&&s(t,e)/u;return Math.acos(h)},subtract:n,sub:n,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a&&Math.abs(t[2]-e[2])<a},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},lerp:r,lerpV:function(e,n,r,i){const o=i??new t(3);return o[0]=e[0]+r[0]*(n[0]-e[0]),o[1]=e[1]+r[1]*(n[1]-e[1]),o[2]=e[2]+r[2]*(n[2]-e[2]),o},max:function(e,n,r){const i=r??new t(3);return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i},min:function(e,n,r){const i=r??new t(3);return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i},mulScalar:i,scale:i,divScalar:function(e,n,r){const i=r??new t(3);return i[0]=e[0]/n,i[1]=e[1]/n,i[2]=e[2]/n,i},inverse:o,invert:o,cross:function(e,n,r){const i=r??new t(3),o=e[2]*n[0]-e[0]*n[2],s=e[0]*n[1]-e[1]*n[0];return i[0]=e[1]*n[2]-e[2]*n[1],i[1]=o,i[2]=s,i},dot:s,length:c,len:c,lengthSq:u,lenSq:u,distance:h,dist:h,distanceSq:f,distSq:f,normalize:l,negate:function(e,n){const r=n??new t(3);return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r},copy:d,clone:d,multiply:m,mul:m,divide:M,div:M,random:function(e=1,n){const r=n??new t(3),i=2*Math.random()*Math.PI,o=2*Math.random()-1,s=Math.sqrt(1-o*o)*e;return r[0]=Math.cos(i)*s,r[1]=Math.sin(i)*s,r[2]=o*e,r},zero:function(e){const n=e??new t(3);return n[0]=0,n[1]=0,n[2]=0,n},transformMat4:function(e,n,r){const i=r??new t(3),o=e[0],s=e[1],a=e[2],c=n[3]*o+n[7]*s+n[11]*a+n[15]||1;return i[0]=(n[0]*o+n[4]*s+n[8]*a+n[12])/c,i[1]=(n[1]*o+n[5]*s+n[9]*a+n[13])/c,i[2]=(n[2]*o+n[6]*s+n[10]*a+n[14])/c,i},transformMat4Upper3x3:function(e,n,r){const i=r??new t(3),o=e[0],s=e[1],a=e[2];return i[0]=o*n[0]+s*n[4]+a*n[8],i[1]=o*n[1]+s*n[5]+a*n[9],i[2]=o*n[2]+s*n[6]+a*n[10],i},transformMat3:function(e,n,r){const i=r??new t(3),o=e[0],s=e[1],a=e[2];return i[0]=o*n[0]+s*n[4]+a*n[8],i[1]=o*n[1]+s*n[5]+a*n[9],i[2]=o*n[2]+s*n[6]+a*n[10],i},transformQuat:function(e,n,r){const i=r??new t(3),o=n[0],s=n[1],a=n[2],c=2*n[3],u=e[0],h=e[1],f=e[2],l=s*f-a*h,d=a*u-o*f,m=o*h-s*u;return i[0]=u+l*c+2*(s*m-a*d),i[1]=h+d*c+2*(a*l-o*m),i[2]=f+m*c+2*(o*d-s*l),i},getTranslation:function(e,n){const r=n??new t(3);return r[0]=e[12],r[1]=e[13],r[2]=e[14],r},getAxis:function(e,n,r){const i=r??new t(3),o=4*n;return i[0]=e[o+0],i[1]=e[o+1],i[2]=e[o+2],i},getScaling:function(e,n){const r=n??new t(3),i=e[0],o=e[1],s=e[2],a=e[4],c=e[5],u=e[6],h=e[8],f=e[9],l=e[10];return r[0]=Math.sqrt(i*i+o*o+s*s),r[1]=Math.sqrt(a*a+c*c+u*u),r[2]=Math.sqrt(h*h+f*f+l*l),r},rotateX:function(e,n,r,i){const o=i??new t(3),s=[],a=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],a[0]=s[0],a[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),a[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),o[0]=a[0]+n[0],o[1]=a[1]+n[1],o[2]=a[2]+n[2],o},rotateY:function(e,n,r,i){const o=i??new t(3),s=[],a=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],a[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),a[1]=s[1],a[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),o[0]=a[0]+n[0],o[1]=a[1]+n[1],o[2]=a[2]+n[2],o},rotateZ:function(e,n,r,i){const o=i??new t(3),s=[],a=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],a[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),a[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),a[2]=s[2],o[0]=a[0]+n[0],o[1]=a[1]+n[1],o[2]=a[2]+n[2],o},setLength:p,truncate:function(e,n,r){const i=r??new t(3);return c(e)>n?p(e,n,i):d(e,i)},midpoint:function(e,n,i){return r(e,n,.5,i??new t(3))}}}(t),h.set(t,e)),e}const l=new Map;function d(t){let e=l.get(t);return e||(e=function(t){const e=u(t),n=f(t);function r(e,n){const r=n??new t(12);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[8]=e[8],r[9]=e[9],r[10]=e[10],r}function i(e){const n=e??new t(12);return n[0]=1,n[1]=0,n[2]=0,n[4]=0,n[5]=1,n[6]=0,n[8]=0,n[9]=0,n[10]=1,n}function o(e,n){const r=n??new t(12),i=e[0],o=e[1],s=e[2],a=e[4],c=e[5],u=e[6],h=e[8],f=e[9],l=e[10],d=l*c-u*f,m=-l*a+u*h,M=f*a-c*h,p=1/(i*d+o*m+s*M);return r[0]=d*p,r[1]=(-l*o+s*f)*p,r[2]=(u*o-s*c)*p,r[4]=m*p,r[5]=(l*i-s*h)*p,r[6]=(-u*i+s*a)*p,r[8]=M*p,r[9]=(-f*i+o*h)*p,r[10]=(c*i-o*a)*p,r}function s(e,n,r){const i=r??new t(12),o=e[0],s=e[1],a=e[2],c=e[4],u=e[5],h=e[6],f=e[8],l=e[9],d=e[10],m=n[0],M=n[1],p=n[2],w=n[4],v=n[5],x=n[6],g=n[8],b=n[9],y=n[10];return i[0]=o*m+c*M+f*p,i[1]=s*m+u*M+l*p,i[2]=a*m+h*M+d*p,i[4]=o*w+c*v+f*x,i[5]=s*w+u*v+l*x,i[6]=a*w+h*v+d*x,i[8]=o*g+c*b+f*y,i[9]=s*g+u*b+l*y,i[10]=a*g+h*b+d*y,i}return{clone:r,create:function(e,n,r,i,o,s,a,c,u){const h=new t(12);return h[3]=0,h[7]=0,h[11]=0,void 0!==e&&(h[0]=e,void 0!==n&&(h[1]=n,void 0!==r&&(h[2]=r,void 0!==i&&(h[4]=i,void 0!==o&&(h[5]=o,void 0!==s&&(h[6]=s,void 0!==a&&(h[8]=a,void 0!==c&&(h[9]=c,void 0!==u&&(h[10]=u))))))))),h},set:function(e,n,r,i,o,s,a,c,u,h){const f=h??new t(12);return f[0]=e,f[1]=n,f[2]=r,f[3]=0,f[4]=i,f[5]=o,f[6]=s,f[7]=0,f[8]=a,f[9]=c,f[10]=u,f[11]=0,f},fromMat4:function(e,n){const r=n??new t(12);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=0,r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=0,r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=0,r},fromQuat:function(e,n){const r=n??new t(12),i=e[0],o=e[1],s=e[2],a=e[3],c=i+i,u=o+o,h=s+s,f=i*c,l=o*c,d=o*u,m=s*c,M=s*u,p=s*h,w=a*c,v=a*u,x=a*h;return r[0]=1-d-p,r[1]=l+x,r[2]=m-v,r[3]=0,r[4]=l-x,r[5]=1-f-p,r[6]=M+w,r[7]=0,r[8]=m+v,r[9]=M-w,r[10]=1-f-d,r[11]=0,r},negate:function(e,n){const r=n??new t(12);return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[4]=-e[4],r[5]=-e[5],r[6]=-e[6],r[8]=-e[8],r[9]=-e[9],r[10]=-e[10],r},copy:r,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a&&Math.abs(t[2]-e[2])<a&&Math.abs(t[4]-e[4])<a&&Math.abs(t[5]-e[5])<a&&Math.abs(t[6]-e[6])<a&&Math.abs(t[8]-e[8])<a&&Math.abs(t[9]-e[9])<a&&Math.abs(t[10]-e[10])<a},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]},identity:i,transpose:function(e,n){const r=n??new t(12);if(r===e){let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,r}const i=e[0],o=e[1],s=e[2],a=e[4],c=e[5],u=e[6],h=e[8],f=e[9],l=e[10];return r[0]=i,r[1]=a,r[2]=h,r[4]=o,r[5]=c,r[6]=f,r[8]=s,r[9]=u,r[10]=l,r},inverse:o,invert:o,determinant:function(t){const e=t[0],n=t[1],r=t[2],i=t[4],o=t[5],s=t[6],a=t[8],c=t[9],u=t[10];return e*(o*u-c*s)-i*(n*u-c*r)+a*(n*s-o*r)},mul:s,multiply:s,setTranslation:function(t,e,n){const r=n??i();return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[4]=t[4],r[5]=t[5],r[6]=t[6]),r[8]=e[0],r[9]=e[1],r[10]=1,r},getTranslation:function(t,n){const r=n??e.create();return r[0]=t[8],r[1]=t[9],r},getAxis:function(t,n,r){const i=r??e.create(),o=4*n;return i[0]=t[o+0],i[1]=t[o+1],i},setAxis:function(t,e,n,i){const o=i===t?t:r(t,i),s=4*n;return o[s+0]=e[0],o[s+1]=e[1],o},getScaling:function(t,n){const r=n??e.create(),i=t[0],o=t[1],s=t[4],a=t[5];return r[0]=Math.sqrt(i*i+o*o),r[1]=Math.sqrt(s*s+a*a),r},get3DScaling:function(t,e){const r=e??n.create(),i=t[0],o=t[1],s=t[2],a=t[4],c=t[5],u=t[6],h=t[8],f=t[9],l=t[10];return r[0]=Math.sqrt(i*i+o*o+s*s),r[1]=Math.sqrt(a*a+c*c+u*u),r[2]=Math.sqrt(h*h+f*f+l*l),r},translation:function(e,n){const r=n??new t(12);return r[0]=1,r[1]=0,r[2]=0,r[4]=0,r[5]=1,r[6]=0,r[8]=e[0],r[9]=e[1],r[10]=1,r},translate:function(e,n,r){const i=r??new t(12),o=n[0],s=n[1],a=e[0],c=e[1],u=e[2],h=e[4],f=e[5],l=e[6],d=e[8],m=e[9],M=e[10];return e!==i&&(i[0]=a,i[1]=c,i[2]=u,i[4]=h,i[5]=f,i[6]=l),i[8]=a*o+h*s+d,i[9]=c*o+f*s+m,i[10]=u*o+l*s+M,i},rotation:function(e,n){const r=n??new t(12),i=Math.cos(e),o=Math.sin(e);return r[0]=i,r[1]=o,r[2]=0,r[4]=-o,r[5]=i,r[6]=0,r[8]=0,r[9]=0,r[10]=1,r},rotate:function(e,n,r){const i=r??new t(12),o=e[0],s=e[1],a=e[2],c=e[4],u=e[5],h=e[6],f=Math.cos(n),l=Math.sin(n);return i[0]=f*o+l*c,i[1]=f*s+l*u,i[2]=f*a+l*h,i[4]=f*c-l*o,i[5]=f*u-l*s,i[6]=f*h-l*a,e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10]),i},scaling:function(e,n){const r=n??new t(12);return r[0]=e[0],r[1]=0,r[2]=0,r[4]=0,r[5]=e[1],r[6]=0,r[8]=0,r[9]=0,r[10]=1,r},scale:function(e,n,r){const i=r??new t(12),o=n[0],s=n[1];return i[0]=o*e[0],i[1]=o*e[1],i[2]=o*e[2],i[4]=s*e[4],i[5]=s*e[5],i[6]=s*e[6],e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10]),i},uniformScaling:function(e,n){const r=n??new t(12);return r[0]=e,r[1]=0,r[2]=0,r[4]=0,r[5]=e,r[6]=0,r[8]=0,r[9]=0,r[10]=1,r},uniformScale:function(e,n,r){const i=r??new t(12);return i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i[4]=n*e[4],i[5]=n*e[5],i[6]=n*e[6],e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10]),i}}}(t),l.set(t,e)),e}const m=new Map;function M(t){let e=m.get(t);return e||(e=function(t){const e=f(t);function n(e,n){const r=n??new t(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}const r=n;function i(e){const n=e??new t(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function o(e,n){const r=n??new t(16),i=e[0],o=e[1],s=e[2],a=e[3],c=e[4],u=e[5],h=e[6],f=e[7],l=e[8],d=e[9],m=e[10],M=e[11],p=e[12],w=e[13],v=e[14],x=e[15],g=m*x,b=v*M,y=h*x,A=v*f,q=h*M,B=m*f,P=s*x,U=v*a,S=s*M,z=m*a,T=s*f,F=h*a,G=l*w,R=p*d,j=c*w,C=p*u,V=c*d,D=l*u,O=i*w,L=p*o,E=i*d,I=l*o,k=i*u,_=c*o,X=g*u+A*d+q*w-(b*u+y*d+B*w),Y=b*o+P*d+z*w-(g*o+U*d+S*w),W=y*o+U*u+T*w-(A*o+P*u+F*w),N=B*o+S*u+F*d-(q*o+z*u+T*d),Z=1/(i*X+c*Y+l*W+p*N);return r[0]=Z*X,r[1]=Z*Y,r[2]=Z*W,r[3]=Z*N,r[4]=Z*(b*c+y*l+B*p-(g*c+A*l+q*p)),r[5]=Z*(g*i+U*l+S*p-(b*i+P*l+z*p)),r[6]=Z*(A*i+P*c+F*p-(y*i+U*c+T*p)),r[7]=Z*(q*i+z*c+T*l-(B*i+S*c+F*l)),r[8]=Z*(G*f+C*M+V*x-(R*f+j*M+D*x)),r[9]=Z*(R*a+O*M+I*x-(G*a+L*M+E*x)),r[10]=Z*(j*a+L*f+k*x-(C*a+O*f+_*x)),r[11]=Z*(D*a+E*f+_*M-(V*a+I*f+k*M)),r[12]=Z*(j*m+D*v+R*h-(V*v+G*h+C*m)),r[13]=Z*(E*v+G*s+L*m-(O*m+I*v+R*s)),r[14]=Z*(O*h+_*v+C*s-(k*v+j*s+L*h)),r[15]=Z*(k*m+V*s+I*h-(E*h+_*m+D*s)),r}const s=o;function c(e,n,r){const i=r??new t(16),o=e[0],s=e[1],a=e[2],c=e[3],u=e[4],h=e[5],f=e[6],l=e[7],d=e[8],m=e[9],M=e[10],p=e[11],w=e[12],v=e[13],x=e[14],g=e[15],b=n[0],y=n[1],A=n[2],q=n[3],B=n[4],P=n[5],U=n[6],S=n[7],z=n[8],T=n[9],F=n[10],G=n[11],R=n[12],j=n[13],C=n[14],V=n[15];return i[0]=o*b+u*y+d*A+w*q,i[1]=s*b+h*y+m*A+v*q,i[2]=a*b+f*y+M*A+x*q,i[3]=c*b+l*y+p*A+g*q,i[4]=o*B+u*P+d*U+w*S,i[5]=s*B+h*P+m*U+v*S,i[6]=a*B+f*P+M*U+x*S,i[7]=c*B+l*P+p*U+g*S,i[8]=o*z+u*T+d*F+w*G,i[9]=s*z+h*T+m*F+v*G,i[10]=a*z+f*T+M*F+x*G,i[11]=c*z+l*T+p*F+g*G,i[12]=o*R+u*j+d*C+w*V,i[13]=s*R+h*j+m*C+v*V,i[14]=a*R+f*j+M*C+x*V,i[15]=c*R+l*j+p*C+g*V,i}const u=c,h=e.create(),l=e.create(),d=e.create();function m(e,n,r){const i=r??new t(16);let o=e[0],s=e[1],a=e[2];const c=Math.sqrt(o*o+s*s+a*a);o/=c,s/=c,a/=c;const u=o*o,h=s*s,f=a*a,l=Math.cos(n),d=Math.sin(n),m=1-l;return i[0]=u+(1-u)*l,i[1]=o*s*m+a*d,i[2]=o*a*m-s*d,i[3]=0,i[4]=o*s*m-a*d,i[5]=h+(1-h)*l,i[6]=s*a*m+o*d,i[7]=0,i[8]=o*a*m+s*d,i[9]=s*a*m-o*d,i[10]=f+(1-f)*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function M(e,n,r,i){const o=i??new t(16);let s=n[0],a=n[1],c=n[2];const u=Math.sqrt(s*s+a*a+c*c);s/=u,a/=u,c/=u;const h=s*s,f=a*a,l=c*c,d=Math.cos(r),m=Math.sin(r),M=1-d,p=h+(1-h)*d,w=s*a*M+c*m,v=s*c*M-a*m,x=s*a*M-c*m,g=f+(1-f)*d,b=a*c*M+s*m,y=s*c*M+a*m,A=a*c*M-s*m,q=l+(1-l)*d,B=e[0],P=e[1],U=e[2],S=e[3],z=e[4],T=e[5],F=e[6],G=e[7],R=e[8],j=e[9],C=e[10],V=e[11];return o[0]=p*B+w*z+v*R,o[1]=p*P+w*T+v*j,o[2]=p*U+w*F+v*C,o[3]=p*S+w*G+v*V,o[4]=x*B+g*z+b*R,o[5]=x*P+g*T+b*j,o[6]=x*U+g*F+b*C,o[7]=x*S+g*G+b*V,o[8]=y*B+A*z+q*R,o[9]=y*P+A*T+q*j,o[10]=y*U+A*F+q*C,o[11]=y*S+A*G+q*V,e!==o&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}return{create:function(e,n,r,i,o,s,a,c,u,h,f,l,d,m,M,p){const w=new t(16);return void 0!==e&&(w[0]=e,void 0!==n&&(w[1]=n,void 0!==r&&(w[2]=r,void 0!==i&&(w[3]=i,void 0!==o&&(w[4]=o,void 0!==s&&(w[5]=s,void 0!==a&&(w[6]=a,void 0!==c&&(w[7]=c,void 0!==u&&(w[8]=u,void 0!==h&&(w[9]=h,void 0!==f&&(w[10]=f,void 0!==l&&(w[11]=l,void 0!==d&&(w[12]=d,void 0!==m&&(w[13]=m,void 0!==M&&(w[14]=M,void 0!==p&&(w[15]=p)))))))))))))))),w},set:function(e,n,r,i,o,s,a,c,u,h,f,l,d,m,M,p,w){const v=w??new t(16);return v[0]=e,v[1]=n,v[2]=r,v[3]=i,v[4]=o,v[5]=s,v[6]=a,v[7]=c,v[8]=u,v[9]=h,v[10]=f,v[11]=l,v[12]=d,v[13]=m,v[14]=M,v[15]=p,v},fromMat3:function(e,n){const r=n??new t(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=0,r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=0,r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},fromQuat:function(e,n){const r=n??new t(16),i=e[0],o=e[1],s=e[2],a=e[3],c=i+i,u=o+o,h=s+s,f=i*c,l=o*c,d=o*u,m=s*c,M=s*u,p=s*h,w=a*c,v=a*u,x=a*h;return r[0]=1-d-p,r[1]=l+x,r[2]=m-v,r[3]=0,r[4]=l-x,r[5]=1-f-p,r[6]=M+w,r[7]=0,r[8]=m+v,r[9]=M-w,r[10]=1-f-d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},negate:function(e,n){const r=n??new t(16);return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r[4]=-e[4],r[5]=-e[5],r[6]=-e[6],r[7]=-e[7],r[8]=-e[8],r[9]=-e[9],r[10]=-e[10],r[11]=-e[11],r[12]=-e[12],r[13]=-e[13],r[14]=-e[14],r[15]=-e[15],r},copy:n,clone:r,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a&&Math.abs(t[2]-e[2])<a&&Math.abs(t[3]-e[3])<a&&Math.abs(t[4]-e[4])<a&&Math.abs(t[5]-e[5])<a&&Math.abs(t[6]-e[6])<a&&Math.abs(t[7]-e[7])<a&&Math.abs(t[8]-e[8])<a&&Math.abs(t[9]-e[9])<a&&Math.abs(t[10]-e[10])<a&&Math.abs(t[11]-e[11])<a&&Math.abs(t[12]-e[12])<a&&Math.abs(t[13]-e[13])<a&&Math.abs(t[14]-e[14])<a&&Math.abs(t[15]-e[15])<a},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},identity:i,transpose:function(e,n){const r=n??new t(16);if(r===e){let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,r}const i=e[0],o=e[1],s=e[2],a=e[3],c=e[4],u=e[5],h=e[6],f=e[7],l=e[8],d=e[9],m=e[10],M=e[11],p=e[12],w=e[13],v=e[14],x=e[15];return r[0]=i,r[1]=c,r[2]=l,r[3]=p,r[4]=o,r[5]=u,r[6]=d,r[7]=w,r[8]=s,r[9]=h,r[10]=m,r[11]=v,r[12]=a,r[13]=f,r[14]=M,r[15]=x,r},inverse:o,determinant:function(t){const e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],c=t[7],u=t[8],h=t[9],f=t[10],l=t[11],d=t[12],m=t[13],M=t[14],p=t[15],w=f*p,v=M*l,x=a*p,g=M*c,b=a*l,y=f*c,A=r*p,q=M*i,B=r*l,P=f*i,U=r*c,S=a*i;return e*(w*s+g*h+b*m-(v*s+x*h+y*m))+o*(v*n+A*h+P*m-(w*n+q*h+B*m))+u*(x*n+q*s+U*m-(g*n+A*s+S*m))+d*(y*n+B*s+S*h-(b*n+P*s+U*h))},invert:s,multiply:c,mul:u,setTranslation:function(t,e,n){const r=n??i();return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11]),r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r},getTranslation:function(t,n){const r=n??e.create();return r[0]=t[12],r[1]=t[13],r[2]=t[14],r},getAxis:function(t,n,r){const i=r??e.create(),o=4*n;return i[0]=t[o+0],i[1]=t[o+1],i[2]=t[o+2],i},setAxis:function(t,e,r,i){const o=i===t?i:n(t,i),s=4*r;return o[s+0]=e[0],o[s+1]=e[1],o[s+2]=e[2],o},getScaling:function(t,n){const r=n??e.create(),i=t[0],o=t[1],s=t[2],a=t[4],c=t[5],u=t[6],h=t[8],f=t[9],l=t[10];return r[0]=Math.sqrt(i*i+o*o+s*s),r[1]=Math.sqrt(a*a+c*c+u*u),r[2]=Math.sqrt(h*h+f*f+l*l),r},perspective:function(e,n,r,i,o){const s=o??new t(16),a=Math.tan(.5*Math.PI-.5*e);if(s[0]=a/n,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,Number.isFinite(i)){const t=1/(r-i);s[10]=i*t,s[14]=i*r*t}else s[10]=-1,s[14]=-r;return s},perspectiveReverseZ:function(e,n,r,i=1/0,o){const s=o??new t(16),a=1/Math.tan(.5*e);if(s[0]=a/n,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,i===1/0)s[10]=0,s[14]=r;else{const t=1/(i-r);s[10]=r*t,s[14]=i*r*t}return s},ortho:function(e,n,r,i,o,s,a){const c=a??new t(16);return c[0]=2/(n-e),c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2/(i-r),c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1/(o-s),c[11]=0,c[12]=(n+e)/(e-n),c[13]=(i+r)/(r-i),c[14]=o/(o-s),c[15]=1,c},frustum:function(e,n,r,i,o,s,a){const c=a??new t(16),u=n-e,h=i-r,f=o-s;return c[0]=2*o/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2*o/h,c[6]=0,c[7]=0,c[8]=(e+n)/u,c[9]=(i+r)/h,c[10]=s/f,c[11]=-1,c[12]=0,c[13]=0,c[14]=o*s/f,c[15]=0,c},frustumReverseZ:function(e,n,r,i,o,s=1/0,a){const c=a??new t(16),u=n-e,h=i-r;if(c[0]=2*o/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2*o/h,c[6]=0,c[7]=0,c[8]=(e+n)/u,c[9]=(i+r)/h,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,s===1/0)c[10]=0,c[14]=o;else{const t=1/(s-o);c[10]=o*t,c[14]=s*o*t}return c},aim:function(n,r,i,o){const s=o??new t(16);return e.normalize(e.subtract(r,n,d),d),e.normalize(e.cross(i,d,h),h),e.normalize(e.cross(d,h,l),l),s[0]=h[0],s[1]=h[1],s[2]=h[2],s[3]=0,s[4]=l[0],s[5]=l[1],s[6]=l[2],s[7]=0,s[8]=d[0],s[9]=d[1],s[10]=d[2],s[11]=0,s[12]=n[0],s[13]=n[1],s[14]=n[2],s[15]=1,s},cameraAim:function(n,r,i,o){const s=o??new t(16);return e.normalize(e.subtract(n,r,d),d),e.normalize(e.cross(i,d,h),h),e.normalize(e.cross(d,h,l),l),s[0]=h[0],s[1]=h[1],s[2]=h[2],s[3]=0,s[4]=l[0],s[5]=l[1],s[6]=l[2],s[7]=0,s[8]=d[0],s[9]=d[1],s[10]=d[2],s[11]=0,s[12]=n[0],s[13]=n[1],s[14]=n[2],s[15]=1,s},lookAt:function(n,r,i,o){const s=o??new t(16);return e.normalize(e.subtract(n,r,d),d),e.normalize(e.cross(i,d,h),h),e.normalize(e.cross(d,h,l),l),s[0]=h[0],s[1]=l[0],s[2]=d[0],s[3]=0,s[4]=h[1],s[5]=l[1],s[6]=d[1],s[7]=0,s[8]=h[2],s[9]=l[2],s[10]=d[2],s[11]=0,s[12]=-(h[0]*n[0]+h[1]*n[1]+h[2]*n[2]),s[13]=-(l[0]*n[0]+l[1]*n[1]+l[2]*n[2]),s[14]=-(d[0]*n[0]+d[1]*n[1]+d[2]*n[2]),s[15]=1,s},translation:function(e,n){const r=n??new t(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r},translate:function(e,n,r){const i=r??new t(16),o=n[0],s=n[1],a=n[2],c=e[0],u=e[1],h=e[2],f=e[3],l=e[4],d=e[5],m=e[6],M=e[7],p=e[8],w=e[9],v=e[10],x=e[11],g=e[12],b=e[13],y=e[14],A=e[15];return e!==i&&(i[0]=c,i[1]=u,i[2]=h,i[3]=f,i[4]=l,i[5]=d,i[6]=m,i[7]=M,i[8]=p,i[9]=w,i[10]=v,i[11]=x),i[12]=c*o+l*s+p*a+g,i[13]=u*o+d*s+w*a+b,i[14]=h*o+m*s+v*a+y,i[15]=f*o+M*s+x*a+A,i},rotationX:function(e,n){const r=n??new t(16),i=Math.cos(e),o=Math.sin(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=o,r[7]=0,r[8]=0,r[9]=-o,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotateX:function(e,n,r){const i=r??new t(16),o=e[4],s=e[5],a=e[6],c=e[7],u=e[8],h=e[9],f=e[10],l=e[11],d=Math.cos(n),m=Math.sin(n);return i[4]=d*o+m*u,i[5]=d*s+m*h,i[6]=d*a+m*f,i[7]=d*c+m*l,i[8]=d*u-m*o,i[9]=d*h-m*s,i[10]=d*f-m*a,i[11]=d*l-m*c,e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i},rotationY:function(e,n){const r=n??new t(16),i=Math.cos(e),o=Math.sin(e);return r[0]=i,r[1]=0,r[2]=-o,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=o,r[9]=0,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotateY:function(e,n,r){const i=r??new t(16),o=e[0],s=e[1],a=e[2],c=e[3],u=e[8],h=e[9],f=e[10],l=e[11],d=Math.cos(n),m=Math.sin(n);return i[0]=d*o-m*u,i[1]=d*s-m*h,i[2]=d*a-m*f,i[3]=d*c-m*l,i[8]=d*u+m*o,i[9]=d*h+m*s,i[10]=d*f+m*a,i[11]=d*l+m*c,e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i},rotationZ:function(e,n){const r=n??new t(16),i=Math.cos(e),o=Math.sin(e);return r[0]=i,r[1]=o,r[2]=0,r[3]=0,r[4]=-o,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotateZ:function(e,n,r){const i=r??new t(16),o=e[0],s=e[1],a=e[2],c=e[3],u=e[4],h=e[5],f=e[6],l=e[7],d=Math.cos(n),m=Math.sin(n);return i[0]=d*o+m*u,i[1]=d*s+m*h,i[2]=d*a+m*f,i[3]=d*c+m*l,i[4]=d*u-m*o,i[5]=d*h-m*s,i[6]=d*f-m*a,i[7]=d*l-m*c,e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i},axisRotation:m,rotation:m,axisRotate:M,rotate:M,scaling:function(e,n){const r=n??new t(16);return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},scale:function(e,n,r){const i=r??new t(16),o=n[0],s=n[1],a=n[2];return i[0]=o*e[0],i[1]=o*e[1],i[2]=o*e[2],i[3]=o*e[3],i[4]=s*e[4],i[5]=s*e[5],i[6]=s*e[6],i[7]=s*e[7],i[8]=a*e[8],i[9]=a*e[9],i[10]=a*e[10],i[11]=a*e[11],e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i},uniformScaling:function(e,n){const r=n??new t(16);return r[0]=e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},uniformScale:function(e,n,r){const i=r??new t(16);return i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i[3]=n*e[3],i[4]=n*e[4],i[5]=n*e[5],i[6]=n*e[6],i[7]=n*e[7],i[8]=n*e[8],i[9]=n*e[9],i[10]=n*e[10],i[11]=n*e[11],e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i}}}(t),m.set(t,e)),e}const p=new Map;function w(t){let e=p.get(t);return e||(e=function(t){const e=f(t);function n(e,n,r,i){const o=new t(4);return void 0!==e&&(o[0]=e,void 0!==n&&(o[1]=n,void 0!==r&&(o[2]=r,void 0!==i&&(o[3]=i)))),o}const r=n;function i(e,n,r){const i=r??new t(4),o=.5*n,s=Math.sin(o);return i[0]=s*e[0],i[1]=s*e[1],i[2]=s*e[2],i[3]=Math.cos(o),i}function o(e,n,r){const i=r??new t(4),o=e[0],s=e[1],a=e[2],c=e[3],u=n[0],h=n[1],f=n[2],l=n[3];return i[0]=o*l+c*u+s*f-a*h,i[1]=s*l+c*h+a*u-o*f,i[2]=a*l+c*f+o*h-s*u,i[3]=c*l-o*u-s*h-a*f,i}const s=o;function c(e,n,r,i){const o=i??new t(4),s=e[0],c=e[1],u=e[2],h=e[3];let f,l,d=n[0],m=n[1],M=n[2],p=n[3],w=s*d+c*m+u*M+h*p;if(w<0&&(w=-w,d=-d,m=-m,M=-M,p=-p),1-w>a){const t=Math.acos(w),e=Math.sin(t);f=Math.sin((1-r)*t)/e,l=Math.sin(r*t)/e}else f=1-r,l=r;return o[0]=f*s+l*d,o[1]=f*c+l*m,o[2]=f*u+l*M,o[3]=f*h+l*p,o}function u(e,n){const r=n??new t(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}const h=u;function l(e,n,r){const i=r??new t(4);return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i}const d=l;function m(e,n,r){const i=r??new t(4);return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i}const M=m;function p(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function w(t){const e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)}const v=w;function x(t){const e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}const g=x;function b(e,n){const r=n??new t(4),i=e[0],o=e[1],s=e[2],a=e[3],c=Math.sqrt(i*i+o*o+s*s+a*a);return c>1e-5?(r[0]=i/c,r[1]=o/c,r[2]=s/c,r[3]=a/c):(r[0]=0,r[1]=0,r[2]=0,r[3]=1),r}const y=e.create(),A=e.create(),q=e.create(),B=new t(4),P=new t(4);return{create:n,fromValues:r,set:function(e,n,r,i,o){const s=o??new t(4);return s[0]=e,s[1]=n,s[2]=r,s[3]=i,s},fromAxisAngle:i,toAxisAngle:function(t,n){const r=n??e.create(3),i=2*Math.acos(t[3]),o=Math.sin(.5*i);return o>a?(r[0]=t[0]/o,r[1]=t[1]/o,r[2]=t[2]/o):(r[0]=1,r[1]=0,r[2]=0),{angle:i,axis:r}},angle:function(t,e){const n=p(t,e);return Math.acos(2*n*n-1)},multiply:o,mul:s,rotateX:function(e,n,r){const i=r??new t(4),o=.5*n,s=e[0],a=e[1],c=e[2],u=e[3],h=Math.sin(o),f=Math.cos(o);return i[0]=s*f+u*h,i[1]=a*f+c*h,i[2]=c*f-a*h,i[3]=u*f-s*h,i},rotateY:function(e,n,r){const i=r??new t(4),o=.5*n,s=e[0],a=e[1],c=e[2],u=e[3],h=Math.sin(o),f=Math.cos(o);return i[0]=s*f-c*h,i[1]=a*f+u*h,i[2]=c*f+s*h,i[3]=u*f-a*h,i},rotateZ:function(e,n,r){const i=r??new t(4),o=.5*n,s=e[0],a=e[1],c=e[2],u=e[3],h=Math.sin(o),f=Math.cos(o);return i[0]=s*f+a*h,i[1]=a*f-s*h,i[2]=c*f+u*h,i[3]=u*f-c*h,i},slerp:c,inverse:function(e,n){const r=n??new t(4),i=e[0],o=e[1],s=e[2],a=e[3],c=i*i+o*o+s*s+a*a,u=c?1/c:0;return r[0]=-i*u,r[1]=-o*u,r[2]=-s*u,r[3]=a*u,r},conjugate:function(e,n){const r=n??new t(4);return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},fromMat:function(e,n){const r=n??new t(4),i=e[0]+e[5]+e[10];if(i>0){const t=Math.sqrt(i+1);r[3]=.5*t;const n=.5/t;r[0]=(e[6]-e[9])*n,r[1]=(e[8]-e[2])*n,r[2]=(e[1]-e[4])*n}else{let t=0;e[5]>e[0]&&(t=1),e[10]>e[4*t+t]&&(t=2);const n=(t+1)%3,i=(t+2)%3,o=Math.sqrt(e[4*t+t]-e[4*n+n]-e[4*i+i]+1);r[t]=.5*o;const s=.5/o;r[3]=(e[4*n+i]-e[4*i+n])*s,r[n]=(e[4*n+t]+e[4*t+n])*s,r[i]=(e[4*i+t]+e[4*t+i])*s}return r},fromEuler:function(e,n,r,i,o){const s=o??new t(4),a=.5*e,c=.5*n,u=.5*r,h=Math.sin(a),f=Math.cos(a),l=Math.sin(c),d=Math.cos(c),m=Math.sin(u),M=Math.cos(u);switch(i){case"xyz":s[0]=h*d*M+f*l*m,s[1]=f*l*M-h*d*m,s[2]=f*d*m+h*l*M,s[3]=f*d*M-h*l*m;break;case"xzy":s[0]=h*d*M-f*l*m,s[1]=f*l*M-h*d*m,s[2]=f*d*m+h*l*M,s[3]=f*d*M+h*l*m;break;case"yxz":s[0]=h*d*M+f*l*m,s[1]=f*l*M-h*d*m,s[2]=f*d*m-h*l*M,s[3]=f*d*M+h*l*m;break;case"yzx":s[0]=h*d*M+f*l*m,s[1]=f*l*M+h*d*m,s[2]=f*d*m-h*l*M,s[3]=f*d*M-h*l*m;break;case"zxy":s[0]=h*d*M-f*l*m,s[1]=f*l*M+h*d*m,s[2]=f*d*m+h*l*M,s[3]=f*d*M-h*l*m;break;case"zyx":s[0]=h*d*M-f*l*m,s[1]=f*l*M+h*d*m,s[2]=f*d*m-h*l*M,s[3]=f*d*M+h*l*m;break;default:throw new Error(`Unknown rotation order: ${i}`)}return s},copy:u,clone:h,add:function(e,n,r){const i=r??new t(4);return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i},subtract:l,sub:d,mulScalar:m,scale:M,divScalar:function(e,n,r){const i=r??new t(4);return i[0]=e[0]/n,i[1]=e[1]/n,i[2]=e[2]/n,i[3]=e[3]/n,i},dot:p,lerp:function(e,n,r,i){const o=i??new t(4);return o[0]=e[0]+r*(n[0]-e[0]),o[1]=e[1]+r*(n[1]-e[1]),o[2]=e[2]+r*(n[2]-e[2]),o[3]=e[3]+r*(n[3]-e[3]),o},length:w,len:v,lengthSq:x,lenSq:g,normalize:b,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a&&Math.abs(t[2]-e[2])<a&&Math.abs(t[3]-e[3])<a},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},identity:function(e){const n=e??new t(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n},rotationTo:function(n,r,o){const s=o??new t(4),a=e.dot(n,r);return a<-.999999?(e.cross(A,n,y),e.len(y)<1e-6&&e.cross(q,n,y),e.normalize(y,y),i(y,Math.PI,s),s):a>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(e.cross(n,r,y),s[0]=y[0],s[1]=y[1],s[2]=y[2],s[3]=1+a,b(s,s))},sqlerp:function(e,n,r,i,o,s){const a=s??new t(4);return c(e,i,o,B),c(n,r,o,P),c(B,P,2*o*(1-o),a),a}}}(t),p.set(t,e)),e}const v=new Map;function x(t){let e=v.get(t);return e||(e=function(t){function e(e,n,r,i){const o=new t(4);return void 0!==e&&(o[0]=e,void 0!==n&&(o[1]=n,void 0!==r&&(o[2]=r,void 0!==i&&(o[3]=i)))),o}function n(e,n,r){const i=r??new t(4);return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i}function r(e,n,r,i){const o=i??new t(4);return o[0]=e[0]+r*(n[0]-e[0]),o[1]=e[1]+r*(n[1]-e[1]),o[2]=e[2]+r*(n[2]-e[2]),o[3]=e[3]+r*(n[3]-e[3]),o}function i(e,n,r){const i=r??new t(4);return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i}function o(e,n){const r=n??new t(4);return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r[3]=1/e[3],r}function s(t){const e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)}function c(t){const e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function u(t,e){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+o*o)}function h(t,e){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return n*n+r*r+i*i+o*o}function f(e,n){const r=n??new t(4),i=e[0],o=e[1],s=e[2],a=e[3],c=Math.sqrt(i*i+o*o+s*s+a*a);return c>1e-5?(r[0]=i/c,r[1]=o/c,r[2]=s/c,r[3]=a/c):(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function l(e,n){const r=n??new t(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function d(e,n,r){const i=r??new t(4);return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i}function m(e,n,r){const i=r??new t(4);return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i[3]=e[3]/n[3],i}function M(e,n,r){const o=r??new t(4);return f(e,o),i(o,n,o)}return{create:e,fromValues:e,set:function(e,n,r,i,o){const s=o??new t(4);return s[0]=e,s[1]=n,s[2]=r,s[3]=i,s},ceil:function(e,n){const r=n??new t(4);return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r[3]=Math.ceil(e[3]),r},floor:function(e,n){const r=n??new t(4);return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r[3]=Math.floor(e[3]),r},round:function(e,n){const r=n??new t(4);return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r[3]=Math.round(e[3]),r},clamp:function(e,n=0,r=1,i){const o=i??new t(4);return o[0]=Math.min(r,Math.max(n,e[0])),o[1]=Math.min(r,Math.max(n,e[1])),o[2]=Math.min(r,Math.max(n,e[2])),o[3]=Math.min(r,Math.max(n,e[3])),o},add:function(e,n,r){const i=r??new t(4);return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i},addScaled:function(e,n,r,i){const o=i??new t(4);return o[0]=e[0]+n[0]*r,o[1]=e[1]+n[1]*r,o[2]=e[2]+n[2]*r,o[3]=e[3]+n[3]*r,o},subtract:n,sub:n,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a&&Math.abs(t[2]-e[2])<a&&Math.abs(t[3]-e[3])<a},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},lerp:r,lerpV:function(e,n,r,i){const o=i??new t(4);return o[0]=e[0]+r[0]*(n[0]-e[0]),o[1]=e[1]+r[1]*(n[1]-e[1]),o[2]=e[2]+r[2]*(n[2]-e[2]),o[3]=e[3]+r[3]*(n[3]-e[3]),o},max:function(e,n,r){const i=r??new t(4);return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i[3]=Math.max(e[3],n[3]),i},min:function(e,n,r){const i=r??new t(4);return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i[3]=Math.min(e[3],n[3]),i},mulScalar:i,scale:i,divScalar:function(e,n,r){const i=r??new t(4);return i[0]=e[0]/n,i[1]=e[1]/n,i[2]=e[2]/n,i[3]=e[3]/n,i},inverse:o,invert:o,dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},length:s,len:s,lengthSq:c,lenSq:c,distance:u,dist:u,distanceSq:h,distSq:h,normalize:f,negate:function(e,n){const r=n??new t(4);return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r},copy:l,clone:l,multiply:d,mul:d,divide:m,div:m,zero:function(e){const n=e??new t(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n},transformMat4:function(e,n,r){const i=r??new t(4),o=e[0],s=e[1],a=e[2],c=e[3];return i[0]=n[0]*o+n[4]*s+n[8]*a+n[12]*c,i[1]=n[1]*o+n[5]*s+n[9]*a+n[13]*c,i[2]=n[2]*o+n[6]*s+n[10]*a+n[14]*c,i[3]=n[3]*o+n[7]*s+n[11]*a+n[15]*c,i},setLength:M,truncate:function(e,n,r){const i=r??new t(4);return s(e)>n?M(e,n,i):l(e,i)},midpoint:function(e,n,i){return r(e,n,.5,i??new t(4))}}}(t),v.set(t,e)),e}function g(t,e,n,r,i,o){return{mat3:d(t),mat4:M(e),quat:w(n),vec2:u(r),vec3:f(i),vec4:x(o)}}const{mat3:b,mat4:y,quat:A,vec2:q,vec3:B,vec4:P}=g(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);g(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array),g(i,Array,Array,Array,Array,Array);class U{device;pipeline;vertexBuffer;indexBuffer;color;position;radius=.5;texture;sampler;numIndices;uniformBuffer;bindGroup;modelMatrix=y.identity();rotation={x:0,y:0,z:0};translation={x:0,y:0,z:0};constructor(t,e,n,r){this.device=t,this.color=new Float32Array(e),this.position=new Float32Array(n),this.radius=r,this.modelMatrix=y.identity(),this.initializeBuffers(),this.createPipeline()}async loadInitialTexture(){this.texture=await n(this.device,"base_map.jpg"),this.sampler=r(this.device),this.createBindGroup()}initializeBuffers(){this.createVertexBuffer(),this.createUniformBuffer()}async loadTextureSphere(t){this.texture=await n(this.device,t),console.log(this.texture),this.sampler=r(this.device),this.createBindGroup()}createVertexBuffer(){const t=128,e=[],n=[];for(let n=0;n<=t;n++){const r=n*Math.PI/t,i=Math.sin(r),o=Math.cos(r);for(let r=0;r<=t;r++){const s=2*r*Math.PI/t,a=Math.sin(s),c=Math.cos(s),u=this.radius*c*i,h=this.radius*o,f=this.radius*a*i;let l=r/t;const d=n/t;l=1-l,e.push(u+this.position[0],h+this.position[1],f+this.position[2],1,l,d)}}for(let e=0;e<t;e++)for(let r=0;r<t;r++){const i=129*e+r,o=i+t+1;n.push(i,o,i+1),n.push(o,o+1,i+1)}this.numIndices=n.length,this.vertexBuffer=this.device.createBuffer({size:4*e.length,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.vertexBuffer.getMappedRange()).set(new Float32Array(e)),this.vertexBuffer.unmap(),this.indexBuffer=this.device.createBuffer({size:4*n.length,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0}),new Uint32Array(this.indexBuffer.getMappedRange()).set(new Uint32Array(n)),this.indexBuffer.unmap()}createUniformBuffer(){this.uniformBuffer=this.device.createBuffer({size:192,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}async createPipeline(){this.pipeline=this.device.createRenderPipeline({layout:"auto",label:"sphere-pipeline",vertex:{module:this.device.createShaderModule({code:"\n            struct Uniforms {\n                viewMatrix: mat4x4<f32>,\n                projectionMatrix: mat4x4<f32>,\n                modelMatrix: mat4x4<f32>,\n            };\n\n            // Define the output structure for vertex shader\n            struct VertexOutput {\n                @builtin(position) position: vec4<f32>,\n                @location(0) uv: vec2<f32>,\n            }\n\n            // Declare the uniform buffer and other resources\n            @group(0) @binding(0) var<uniform> uniforms: Uniforms;\n\n            @vertex\n            fn vs_main(@location(0) position: vec4<f32>, @location(1) uv: vec2<f32>) -> VertexOutput {\n                var output: VertexOutput;\n                let worldPosition = uniforms.modelMatrix * vec4<f32>(position.xyz, 1.0);\n                let viewPosition = uniforms.viewMatrix * worldPosition;\n                let clipPosition = uniforms.projectionMatrix * viewPosition;\n                output.position = clipPosition;\n                output.uv = uv; // Pass the UV coordinates to the fragment shader\n                return output;\n            }"}),entryPoint:"vs_main",buffers:[{arrayStride:24,attributes:[{shaderLocation:0,offset:0,format:"float32x4"},{shaderLocation:1,offset:16,format:"float32x2"}]}]},fragment:{module:this.device.createShaderModule({code:"\n            @group(0) @binding(1) var mySampler: sampler;\n            @group(0) @binding(2) var myTexture: texture_2d<f32>;\n\n            @fragment\n            fn fs_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n                // Use the UV coordinates to sample the texture\n                return textureSample(myTexture, mySampler, uv);\n            }\n        "}),entryPoint:"fs_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}})}async createBindGroup(){console.log("this.texture");const t=this.pipeline.getBindGroupLayout(0);this.bindGroup=this.device.createBindGroup({layout:t,entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:this.sampler},{binding:2,resource:this.texture.createView()}]})}updateUniformBuffer(){this.device.queue.writeBuffer(this.uniformBuffer,0,this.modelMatrix.buffer,this.modelMatrix.byteOffset,this.modelMatrix.byteLength)}rotate(t,e){const n=new Float32Array(t);y.axisRotate(this.modelMatrix,B.fromValues(n[0],n[1],n[2]),e,this.modelMatrix),this.updateUniformBuffer()}draw(t,e){this.device.queue.writeBuffer(this.uniformBuffer,0,e.viewMatrix.buffer,e.viewMatrix.byteOffset,e.viewMatrix.byteLength),this.device.queue.writeBuffer(this.uniformBuffer,64,e.projectionMatrix.buffer,e.projectionMatrix.byteOffset,e.projectionMatrix.byteLength),this.device.queue.writeBuffer(this.uniformBuffer,128,this.modelMatrix.buffer,this.modelMatrix.byteOffset,this.modelMatrix.byteLength),t.setPipeline(this.pipeline),t.setVertexBuffer(0,this.vertexBuffer),t.setIndexBuffer(this.indexBuffer,"uint32"),t.setBindGroup(0,this.bindGroup),t.drawIndexed(this.numIndices)}}class S{position;target;up;viewMatrix;projectionMatrix;fov;aspectRatio;near;far;orientation=A.create();distance;angularVelocity=.01;axis=B.create();constructor(t,e,n,r,i,o,s){this.position=new Float32Array(t),this.target=new Float32Array(e),this.up=new Float32Array(n),this.fov=r*Math.PI/180,this.aspectRatio=i,this.near=o,this.far=s,this.distance=B.length(B.subtract(new Float32Array(3),t,e)),this.viewMatrix=y.lookAt(this.position,this.target,this.up),this.projectionMatrix=y.perspective(this.fov,this.aspectRatio,this.near,this.far)}updateViewMatrix(){y.lookAt(this.position,this.target,this.up,this.viewMatrix)}setAspectRatio(t){this.aspectRatio=t,this.updateProjectionMatrix()}lookAt(t){this.target=new Float32Array(t),this.updateViewMatrix()}setPosition(t){this.position=new Float32Array(t),this.updateViewMatrix()}updateProjectionMatrix(){y.perspective(this.fov,this.aspectRatio,this.near,this.far,this.projectionMatrix)}move(t){B.add(this.position,t,this.position),this.updateViewMatrix()}}class z{camera;canvas;isMouseDown=!1;lastMouseX=null;lastMouseY=null;mouseDelta={x:0,y:0};constructor(t,e){this.camera=t,this.canvas=e,this.addKeyboardListeners(),this.addMouseListeners()}addKeyboardListeners(){window.addEventListener("keydown",this.handleKeyDown)}addMouseListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("wheel",this.handleMouseWheel)}handleMouseDown=t=>{this.isMouseDown=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY};handleMouseUp=()=>{this.isMouseDown=!1};handleMouseMove=t=>{if(!this.isMouseDown)return;const e=t.clientX-(this.lastMouseX||t.clientX),n=t.clientY-(this.lastMouseY||t.clientY);this.mouseDelta.x+=e,this.mouseDelta.y+=n,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY};handleMouseWheel=t=>{t.preventDefault();const e=t.deltaY>0?-1:1;let n=[this.camera.target[0]-this.camera.position[0],this.camera.target[1]-this.camera.position[1],this.camera.target[2]-this.camera.position[2]];const r=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n=[n[0]/r,n[1]/r,n[2]/r],this.camera.setPosition([this.camera.position[0]+.1*n[0]*e,this.camera.position[1]+.1*n[1]*e,this.camera.position[2]+.1*n[2]*e]),this.camera.updateViewMatrix()};updateCameraOrbit(t){let e=Math.sqrt(this.camera.position[0]**2+this.camera.position[1]**2+this.camera.position[2]**2),n=Math.atan2(this.camera.position[0],this.camera.position[2]),r=Math.acos(this.camera.position[1]/e);n-=this.mouseDelta.x*t*.5,r-=this.mouseDelta.y*t*.5,r=Math.max(.1,Math.min(Math.PI-.1,r)),this.camera.setPosition([e*Math.sin(r)*Math.sin(n),e*Math.cos(r),e*Math.sin(r)*Math.cos(n)]),this.mouseDelta.x=0,this.mouseDelta.y=0,this.camera.lookAt([0,0,0])}handleKeyDown=t=>{switch(t.key){case"ArrowUp":case"w":this.moveCamera([0,0,-.1]);break;case"ArrowDown":case"s":this.moveCamera([0,0,.1]);break;case"ArrowLeft":case"a":this.moveCamera([-.1,0,0]);break;case"ArrowRight":case"d":this.moveCamera([.1,0,0]);break;case"q":this.moveCamera([0,.1,0]);break;case"e":this.moveCamera([0,-.1,0])}t.preventDefault()};moveCamera(t){this.camera.move(t)}}class T{canvas;context;device;swapChainFormat="bgra8unorm";scene;camera;cameraControls;depthTexture;lastRenderTime=0;sphere;constructor(n){this.canvas=document.getElementById(n),this.initializeWebGPU().then((()=>{this.clearCanvas(),this.createDepthTexture(),this.camera=new S([2,2,-5],[0,0,0],[0,1,0],45,this.canvas.width/this.canvas.height,.1,100),this.resizeCanvas(),this.cameraControls=new z(this.camera,this.canvas),this.scene=new t(this.device);const n=new e(this.device,[1,0,0,1],[.5,.5,0]),r=new e(this.device,[1,0,1,1],[0,-1,0]),i=new U(this.device,[0,-1,0,1],[0,0,0],.6),o=new U(this.device,[0,-1,0,1],[10,0,40],10);o.loadTextureSphere("sun.jpg"),i.loadTextureSphere("base_map.jpg"),this.scene.addObject(n),this.scene.addObject(r),this.scene.addObject(i),this.scene.addObject(o),this.startRenderingLoop()})).catch((t=>{console.error("Failed to initialize WebGPU:",t)}))}createDepthTexture(){this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture({size:{width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1},format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT})}async initializeWebGPU(){if(!navigator.gpu)throw new Error("WebGPU is not supported.");const t=await navigator.gpu.requestAdapter();if(!t)throw new Error("Failed to get GPU adapter.");this.device=await t.requestDevice(),this.context=this.canvas.getContext("webgpu");window.devicePixelRatio;this.canvas.clientWidth,this.canvas.clientHeight;const e={device:this.device,alphaMode:"premultiplied",format:this.swapChainFormat};this.context.configure(e)}resizeCanvas(){this.canvas.width=this.canvas.clientWidth*window.devicePixelRatio,this.canvas.height=this.canvas.clientHeight*window.devicePixelRatio,this.camera.setAspectRatio(this.canvas.width/this.canvas.height),this.camera.updateProjectionMatrix(),this.createDepthTexture()}clearCanvas(){const t=this.device.createCommandEncoder(),e={colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:0,g:0,b:0,a:1},storeOp:"store"}]};t.beginRenderPass(e).end();const n=t.finish();this.device.queue.submit([n])}startRenderingLoop(){const t=()=>{this.render(),requestAnimationFrame(t)};requestAnimationFrame(t)}render(){this.camera.updateViewMatrix(),this.camera.updateProjectionMatrix(),this.cameraControls.updateCameraOrbit(.01);const t=this.device.createCommandEncoder(),e={colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:0,g:0,b:0,a:1},storeOp:"store"}],depthStencilAttachment:{view:this.depthTexture.createView(),depthLoadOp:"clear",depthClearValue:1,depthStoreOp:"store"}},n=t.beginRenderPass(e);this.scene.draw(n,this.camera),n.end();const r=t.finish();this.device.queue.submit([r])}}(async function(){if(!navigator.gpu)return console.error("WebGPU is not supported on this device!"),!1;try{const t=await navigator.gpu.requestAdapter();if(!t)return console.error("Failed to get GPU adapter!"),!1;if(!await t.requestDevice())return console.error("Failed to get GPU device!"),!1}catch(t){return console.error("An error occurred while initializing WebGPU:",t),!1}return console.log("WebGPU is supported."),!0})().then((t=>{t?(console.log("Loading rendering engine..."),new T("gpuCanvas")):console.log("Rendering engine cannot be loaded due to lack of WebGPU support.")}))}();
//# sourceMappingURL=bundle.js.map
